

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zone-Policy example &mdash; VyOS 1.5.x (circinus) documentation</title>
      <link rel="stylesheet" type="text/css" href="../static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="../static/vyos-logo-icon.png"/>
      <script src="../static/jquery.js?v=5d32c60e"></script>
      <script src="../static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../static/documentation_options.js?v=719443cf"></script>
      <script src="../static/doctools.js?v=9bcbadda"></script>
      <script src="../static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../static/design-tabs.js?v=f930bc37"></script>
    <script src="../static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="BGP IPv6 unnumbered with extended nexthop" href="bgp-ipv6-unnumbered.html" />
    <link rel="prev" title="Bridge and firewall example" href="fwall-and-bridge.html" />
    <style>#vyos-header-iframe{position:fixed;top:0;left:0;right:0;z-index:999999999;width:100%;border:none}</style>
    <style>#vyos-footer-iframe{width:100%;border:none}</style>
    <link href="../static/css/custom.css" rel="stylesheet" type="text/css">
    <link href="../static/css/lists.css" rel="stylesheet" type="text/css">
    <link href="../static/css/hints.css" rel="stylesheet" type="text/css">
    <link href="../static/css/headers.css" rel="stylesheet" type="text/css">
    <link href="../static/css/breadcrumbs.css" rel="stylesheet" type="text/css">
    <link href="../static/css/linkButtons.css" rel="stylesheet" type="text/css">
    <link href="../static/css/text.css" rel="stylesheet" type="text/css">
    <link href="../static/css/leftSidebar.css" rel="stylesheet" type="text/css">
    <link href="../static/css/scrolls.css" rel="stylesheet" type="text/css">
    <link href="../static/css/tables.css" rel="stylesheet" type="text/css">
    <link href="../static/css/installation/running-on-bare-metal.css" rel="stylesheet" type="text/css">
    <link href="../static/css/code-snippets.css" rel="stylesheet" type="text/css">
    <link href="../static/css/separate-commands.css" rel="stylesheet" type="text/css">
    <link href="../static/css/configuration/index.css" rel="stylesheet" type="text/css">
    <link href="../static/css/datatables.css" rel="stylesheet" type="text/css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script type="text/javascript" charset="utf8" src="../static/js/datatables.js"></script>
    <script type="text/javascript" charset="utf8" src="../static/js/tables.js"></script>
    <script type="text/javascript" charset="utf8" src="../static/js/codecopier.js"></script>
    <script type="text/javascript" charset="utf8" src="../static/js/sidebar.js"></script>
    <script type="text/javascript" charset="utf8" src="../static/js/footer.js"></script>
    </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            VyOS
              <img src="../static/vyos-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../introducing/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introducing/history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/index.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">First Steps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation and Image Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick-start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html#configuration-overview">Configuration Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Adminguide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operation/index.html">Operation Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../automation/index.html">VyOS Automation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Configuration Blueprints</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="firewall.html">Firewall Examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="fwall-and-vrf.html">VRF and firewall example</a></li>
<li class="toctree-l3"><a class="reference internal" href="fwall-and-bridge.html">Bridge and firewall example</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Zone-Policy example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#native-ipv4-and-ipv6">Native IPv4 and IPv6</a></li>
<li class="toctree-l4"><a class="reference internal" href="#zones-basics">Zones Basics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ipv6-tunnel">IPv6 Tunnel</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bgp-ipv6-unnumbered.html">BGP IPv6 unnumbered with extended nexthop</a></li>
<li class="toctree-l2"><a class="reference internal" href="ospf-unnumbered.html">OSPF unnumbered with ECMP</a></li>
<li class="toctree-l2"><a class="reference internal" href="azure-vpn-bgp.html">Route-Based Site-to-Site VPN to Azure (BGP over IKEv2/IPsec)</a></li>
<li class="toctree-l2"><a class="reference internal" href="azure-vpn-dual-bgp.html">Route-Based Redundant Site-to-Site VPN to Azure (BGP over IKEv2/IPsec)</a></li>
<li class="toctree-l2"><a class="reference internal" href="ha.html">High Availability Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="wan-load-balancing.html">WAN Load Balancer examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="pppoe-ipv6-basic.html">PPPoE IPv6 Basic Setup for Home Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="l3vpn-hub-and-spoke.html">L3VPN for Hub-and-Spoke connectivity with VyOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="lac-lns.html">PPPoE over L2TP</a></li>
<li class="toctree-l2"><a class="reference internal" href="inter-vrf-routing-vrf-lite.html">Inter-VRF Routing over VRF Lite</a></li>
<li class="toctree-l2"><a class="reference internal" href="qos.html">QoS example</a></li>
<li class="toctree-l2"><a class="reference internal" href="segment-routing-isis.html">Segment-routing IS-IS example</a></li>
<li class="toctree-l2"><a class="reference internal" href="nmp.html">NMP example</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible.html">Ansible example</a></li>
<li class="toctree-l2"><a class="reference internal" href="policy-based-ipsec-and-firewall.html">Policy-Based Site-to-Site VPN and Firewall Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="site-2-site-cisco.html">Site-to-Site IPSec VPN to Cisco using FlexVPN</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#configuration-blueprints-autotest">Configuration Blueprints (autotest)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/build-vyos.html">Build VyOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/issues-features.html">Issues/Feature requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/upstream-packages.html">Upstream packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/testing.html">Testing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../documentation.html">Write Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coverage.html">Coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../copyright.html">Copyright Notice</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">VyOS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Configuration Blueprints</a></li>
          <li class="breadcrumb-item"><a href="firewall.html">Firewall Examples</a></li>
      <li class="breadcrumb-item active">Zone-Policy example</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../sources/configexamples/zone-policy.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="zone-policy-example">
<span id="examples-zone-policy"></span><h1>Zone-Policy example<a class="headerlink" href="#zone-policy-example" title="Link to this heading"></a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In <a class="reference external" href="https://vyos.dev/T2199">T2199</a> the syntax of the zone configuration was changed.
The zone configuration moved from <code class="docutils literal notranslate"><span class="pre">zone-policy</span> <span class="pre">zone</span> <span class="pre">&lt;name&gt;</span></code> to <code class="docutils literal notranslate"><span class="pre">firewall</span>
<span class="pre">zone</span> <span class="pre">&lt;name&gt;</span></code>.</p>
</div>
<section id="native-ipv4-and-ipv6">
<h2>Native IPv4 and IPv6<a class="headerlink" href="#native-ipv4-and-ipv6" title="Link to this heading"></a></h2>
<p>We have three networks.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>WAN - 172.16.10.0/24, 2001:0DB8:0:9999::0/64
LAN - 192.168.100.0/24, 2001:0DB8:0:AAAA::0/64
DMZ - 192.168.200.0/24, 2001:0DB8:0:BBBB::0/64
</pre></div>
</div>
<p><strong>This specific example is for a router on a stick, but is very easily
adapted for however many NICs you have</strong>:</p>
<ul class="simple">
<li><p>Internet - 192.168.200.100 - TCP/80</p></li>
<li><p>Internet - 192.168.200.100 - TCP/443</p></li>
<li><p>Internet - 192.168.200.100 - TCP/25</p></li>
<li><p>Internet - 192.168.200.100 - TCP/53</p></li>
<li><p>VyOS acts as DHCP, DNS forwarder, NAT, router and firewall.</p></li>
<li><p>192.168.200.200/2001:0DB8:0:BBBB::200 is an internal/external DNS, web
and mail (SMTP/IMAP) server.</p></li>
<li><p>192.168.100.10/2001:0DB8:0:AAAA::10 is the administrator’s console. It
can SSH to VyOS.</p></li>
<li><p>LAN and DMZ hosts have basic outbound access: Web, FTP, SSH.</p></li>
<li><p>LAN can access DMZ resources.</p></li>
<li><p>DMZ cannot access LAN resources.</p></li>
<li><p>Inbound WAN connect to DMZ host.</p></li>
</ul>
<a class="reference internal image-reference" href="../images/zone-policy-diagram.png"><img alt="Network Topology Diagram" class="align-center" src="../images/zone-policy-diagram.png" style="width: 80%;" />
</a>
<p>The VyOS interface is assigned the .1/:1 address of their respective
networks. WAN is on VLAN 10, LAN on VLAN 20, and DMZ on VLAN 30.</p>
<p>It will look something like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>interfaces {
    ethernet eth0 {
        duplex auto
        hw-id 00:53:ed:6e:2a:92
        smp_affinity auto
        speed auto
        vif 10 {
            address 172.16.10.1/24
            address 2001:db8:0:9999::1/64
        }
        vif 20 {
            address 192.168.100.1/24
            address 2001:db8:0:AAAA::1/64
        }
        vif 30 {
            address 192.168.200.1/24
            address 2001:db8:0:BBBB::1/64
        }
    }
    loopback lo {
    }
}
</pre></div>
</div>
</section>
<section id="zones-basics">
<h2>Zones Basics<a class="headerlink" href="#zones-basics" title="Link to this heading"></a></h2>
<p>Each interface is assigned to a zone. The interface can be physical or
virtual such as tunnels (VPN, PPTP, GRE, etc) and are treated exactly
the same.</p>
<p>Traffic flows from zone A to zone B. That flow is what I refer to as a
zone-pair-direction. eg. A-&gt;B and B-&gt;A are two zone-pair-destinations.</p>
<p>Ruleset are created per zone-pair-direction.</p>
<p>I name rule sets to indicate which zone-pair-direction they represent.
eg. ZoneA-ZoneB or ZoneB-ZoneA. LAN-DMZ, DMZ-LAN.</p>
<p>In VyOS, you have to have unique Ruleset names. In the event of overlap,
I add a “-6” to the end of v6 rulesets. eg. LAN-DMZ, LAN-DMZ-6. This
allows for each auto-completion and uniqueness.</p>
<p>In this example we have 4 zones. LAN, WAN, DMZ, Local. The local zone is
the firewall itself.</p>
<p>If your computer is on the LAN and you need to SSH into your VyOS box,
you would need a rule to allow it in the LAN-Local ruleset. If you want
to access a webpage from your VyOS box, you need a rule to allow it in
the Local-LAN ruleset.</p>
<p>In rules, it is good to keep them named consistently. As the number of
rules you have grows, the more consistency you have, the easier your
life will be.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Rule 1 - State Established, Related
Rule 2 - State Invalid
Rule 100 - ICMP
Rule 200 - Web
Rule 300 - FTP
Rule 400 - NTP
Rule 500 - SMTP
Rule 600 - DNS
Rule 700 - DHCP
Rule 800 - SSH
Rule 900 - IMAPS
</pre></div>
</div>
<p>The first two rules are to deal with the idiosyncrasies of VyOS and
iptables.</p>
<p>Zones and Rulesets both have a default action statement. When using
Zone-Policies, the default action is set by the zone-policy statement
and is represented by rule 10000.</p>
<p>It is good practice to log both accepted and denied traffic. It can save
you significant headaches when trying to troubleshoot a connectivity
issue.</p>
<p>To add logging to the default rule, do:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set firewall name &lt;ruleSet&gt; default-log
</pre></div>
</div>
<p>By default, iptables does not allow traffic for established sessions to
return, so you must explicitly allow this. I do this by adding two rules
to every ruleset. 1 allows established and related state packets through
and rule 2 drops and logs invalid state packets. We place the
established/related rule at the top because the vast majority of traffic
on a network is established and the invalid rule to prevent invalid
state packets from mistakenly being matched against other rules. Having
the most matched rule listed first reduces CPU load in high volume
environments. Note: I have filed a bug to have this added as a default
action as well.</p>
<p>‘’It is important to note, that you do not want to add logging to the
established state rule as you will be logging both the inbound and
outbound packets for each session instead of just the initiation of the
session. Your logs will be massive in a very short period of time.’’</p>
<p>In VyOS you must have the interfaces created before you can apply it to
the zone and the rulesets must be created prior to applying it to a
zone-policy.</p>
<p>I create/configure the interfaces first. Build out the rulesets for each
zone-pair-direction which includes at least the three state rules. Then
I setup the zone-policies.</p>
<p>Zones do not allow for a default action of accept; either drop or
reject. It is important to remember this because if you apply an
interface to a zone and commit, any active connections will be dropped.
Specifically, if you are SSH’d into VyOS and add local or the interface
you are connecting through to a zone and do not have rulesets in place
to allow SSH and established sessions, you will not be able to connect.</p>
<p>The following are the rules that were created for this example (may not
be complete), both in IPv4 and IPv6. If there is no IP specified, then
the source/destination address is not explicit.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>WAN - DMZ:192.168.200.200 - tcp/80
WAN - DMZ:192.168.200.200 - tcp/443
WAN - DMZ:192.168.200.200 - tcp/25
WAN - DMZ:192.168.200.200 - tcp/53
WAN - DMZ:2001:0DB8:0:BBBB::200 - tcp/80
WAN - DMZ:2001:0DB8:0:BBBB::200 - tcp/443
WAN - DMZ:2001:0DB8:0:BBBB::200 - tcp/25
WAN - DMZ:2001:0DB8:0:BBBB::200 - tcp/53

DMZ - Local - tcp/53
DMZ - Local - tcp/123
DMZ - Local - tcp/67,68

LAN - Local - tcp/53
LAN - Local - tcp/123
LAN - Local - tcp/67,68
LAN:192.168.100.10 - Local - tcp/22
LAN:2001:0DB8:0:AAAA::10 - Local - tcp/22

LAN - WAN - tcp/80
LAN - WAN - tcp/443
LAN - WAN - tcp/22
LAN - WAN - tcp/20,21

DMZ - WAN - tcp/80
DMZ - WAN - tcp/443
DMZ - WAN - tcp/22
DMZ - WAN - tcp/20,21
DMZ - WAN - tcp/53
DMZ - WAN - udp/53

Local - WAN - tcp/80
Local - WAN - tcp/443
Local - WAN - tcp/20,21

Local - DMZ - tcp/25
Local - DMZ - tcp/67,68
Local - DMZ - tcp/53
Local - DMZ - udp/53

Local - LAN - tcp/67,68

LAN - DMZ - tcp/80
LAN - DMZ - tcp/443
LAN - DMZ - tcp/993
LAN:2001:0DB8:0:AAAA::10 - DMZ:2001:0DB8:0:BBBB::200 - tcp/22
LAN:192.168.100.10 - DMZ:192.168.200.200 - tcp/22
</pre></div>
</div>
<p>Since we have 4 zones, we need to setup the following rulesets.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Lan-wan
Lan-local
Lan-dmz
Wan-lan
Wan-local
Wan-dmz
Local-lan
Local-wan
Local-dmz
Dmz-lan
Dmz-wan
Dmz-local
</pre></div>
</div>
<p>Even if the two zones will never communicate, it is a good idea to
create the zone-pair-direction rulesets and set default-log. This
will allow you to log attempts to access the networks. Without it, you
will never see the connection attempts.</p>
<p>This is an example of the three base rules.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>name wan-lan {
  default-action drop
  default-log
  rule 1 {
    action accept
    state {
      established enable
      related enable
    }
  }
  rule 2 {
    action drop
    log enable
    state {
      invalid enable
    }
  }
}
</pre></div>
</div>
<p>Here is an example of an IPv6 DMZ-WAN ruleset.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ipv6-name dmz-wan-6 {
  default-action drop
  default-log
  rule 1 {
    action accept
    state {
      established enable
      related enable
    }
  }
  rule 2 {
    action drop
    log enable
    state {
      invalid enable
  }
  rule 100 {
    action accept
    log enable
    protocol ipv6-icmp
  }
  rule 200 {
    action accept
    destination {
      port 80,443
    }
    log enable
    protocol tcp
  }
  rule 300 {
    action accept
    destination {
      port 20,21
    }
    log enable
    protocol tcp
  }
  rule 500 {
    action accept
    destination {
      port 25
    }
    log enable
    protocol tcp
    source {
      address 2001:db8:0:BBBB::200
    }
  }
  rule 600 {
    action accept
    destination {
      port 53
    }
    log enable
    protocol tcp_udp
    source {
      address 2001:db8:0:BBBB::200
    }
  }
  rule 800 {
    action accept
    destination {
    port 22
    }
    log enable
    protocol tcp
  }
}
</pre></div>
</div>
<p>Once you have all of your rulesets built, then you need to create your
zone-policy.</p>
<p>Start by setting the interface and default action for each zone.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set firewall zone dmz default-action drop
set firewall zone dmz interface eth0.30
</pre></div>
</div>
<p>In this case, we are setting the v6 ruleset that represents traffic
sourced from the LAN, destined for the DMZ. Because the zone-policy
firewall syntax is a little awkward, I keep it straight by thinking of
it backwards.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set firewall zone dmz from lan firewall ipv6-name lan-dmz-6
</pre></div>
</div>
<p>DMZ-LAN policy is LAN-DMZ. You can get a rhythm to it when you build out
a bunch at one time.</p>
<p>In the end, you will end up with something like this config. I took out
everything but the Firewall, Interfaces, and zone-policy sections. It is
long enough as is.</p>
</section>
<section id="ipv6-tunnel">
<h2>IPv6 Tunnel<a class="headerlink" href="#ipv6-tunnel" title="Link to this heading"></a></h2>
<p>If you are using a IPv6 tunnel from HE.net or someone else, the basis is
the same except you have two WAN interfaces. One for v4 and one for v6.</p>
<p>You would have 5 zones instead of just 4 and you would configure your v6
ruleset between your tunnel interface and your LAN/DMZ zones instead of
to the WAN.</p>
<p>LAN, WAN, DMZ, local and TUN (tunnel)</p>
<p>v6 pairs would be:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>lan-tun
lan-local
lan-dmz
tun-lan
tun-local
tun-dmz
local-lan
local-tun
local-dmz
dmz-lan
dmz-tun
dmz-local
</pre></div>
</div>
<p>Notice, none go to WAN since WAN wouldn’t have a v6 address on it.</p>
<p>You would have to add a couple of rules on your wan-local ruleset to
allow protocol 41 in.</p>
<p>Something like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>rule 400 {
  action accept
  destination {
    address 172.16.10.1
  }
  log enable
  protocol 41
  source {
    address ip.of.tunnel.broker
  }
}
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="fwall-and-bridge.html" class="btn btn-neutral float-left" title="Bridge and firewall example" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="bgp-ipv6-unnumbered.html" class="btn btn-neutral float-right" title="BGP IPv6 unnumbered with extended nexthop" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../copyright.html">Copyright</a> 2024, VyOS maintainers and contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>