

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BGP &mdash; VyOS 1.5.x (circinus) documentation</title>
      <link rel="stylesheet" type="text/css" href="../../static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="../../static/vyos-logo-icon.png"/>
      <script src="../../static/jquery.js?v=5d32c60e"></script>
      <script src="../../static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../static/documentation_options.js?v=719443cf"></script>
      <script src="../../static/doctools.js?v=9bcbadda"></script>
      <script src="../../static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../static/design-tabs.js?v=f930bc37"></script>
    <script src="../../static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="Failover" href="failover.html" />
    <link rel="prev" title="BFD" href="bfd.html" />
    <style>#vyos-header-iframe{position:fixed;top:0;left:0;right:0;z-index:999999999;width:100%;border:none}</style>
    <style>#vyos-footer-iframe{width:100%;border:none}</style>
    <link href="../../static/css/custom.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/lists.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/hints.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/headers.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/breadcrumbs.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/linkButtons.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/text.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/leftSidebar.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/scrolls.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/tables.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/installation/running-on-bare-metal.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/code-snippets.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/separate-commands.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/configuration/index.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/datatables.css" rel="stylesheet" type="text/css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script type="text/javascript" charset="utf8" src="../../static/js/datatables.js"></script>
    <script type="text/javascript" charset="utf8" src="../../static/js/tables.js"></script>
    <script type="text/javascript" charset="utf8" src="../../static/js/codecopier.js"></script>
    <script type="text/javascript" charset="utf8" src="../../static/js/sidebar.js"></script>
    <script type="text/javascript" charset="utf8" src="../../static/js/footer.js"></script>
    </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            VyOS
              <img src="../../static/vyos-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../introducing/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introducing/history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog/index.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">First Steps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation and Image Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quick-start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli.html#configuration-overview">Configuration Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Adminguide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Configuration Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../container/index.html">Container</a></li>
<li class="toctree-l2"><a class="reference internal" href="../firewall/index.html">Firewall</a></li>
<li class="toctree-l2"><a class="reference internal" href="../highavailability/index.html">High availability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interfaces/index.html">Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../loadbalancing/index.html">Load-balancing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nat/index.html">NAT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../policy/index.html">Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pki/index.html">PKI</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Protocols</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="arp.html">ARP</a></li>
<li class="toctree-l3"><a class="reference internal" href="babel.html">Babel</a></li>
<li class="toctree-l3"><a class="reference internal" href="bfd.html">BFD</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">BGP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basic-concepts">Basic Concepts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#operational-mode-commands">Operational Mode Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="failover.html">Failover</a></li>
<li class="toctree-l3"><a class="reference internal" href="igmp-proxy.html">IGMP Proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="isis.html">IS-IS</a></li>
<li class="toctree-l3"><a class="reference internal" href="mpls.html">MPLS</a></li>
<li class="toctree-l3"><a class="reference internal" href="multicast.html">Multicast</a></li>
<li class="toctree-l3"><a class="reference internal" href="segment-routing.html">Segment Routing</a></li>
<li class="toctree-l3"><a class="reference internal" href="openfabric.html">OpenFabric</a></li>
<li class="toctree-l3"><a class="reference internal" href="ospf.html">OSPF</a></li>
<li class="toctree-l3"><a class="reference internal" href="pim.html">PIM – Protocol Independent Multicast</a></li>
<li class="toctree-l3"><a class="reference internal" href="pim6.html">PIM6 - Protocol Independent Multicast for IPv6</a></li>
<li class="toctree-l3"><a class="reference internal" href="rip.html">RIP</a></li>
<li class="toctree-l3"><a class="reference internal" href="rpki.html">RPKI</a></li>
<li class="toctree-l3"><a class="reference internal" href="static.html">Static</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../service/index.html">Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../system/index.html">System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../trafficpolicy/index.html">Traffic Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vpn/index.html">VPN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vrf/index.html">VRF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vrf/index.html#l3vpn-vrfs">L3VPN VRFs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../operation/index.html">Operation Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../automation/index.html">VyOS Automation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configexamples/index.html">Configuration Blueprints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configexamples/index.html#configuration-blueprints-autotest">Configuration Blueprints (autotest)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/build-vyos.html">Build VyOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/issues-features.html">Issues/Feature requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/upstream-packages.html">Upstream packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/testing.html">Testing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">Write Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../coverage.html">Coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../copyright.html">Copyright Notice</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">VyOS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Configuration Guide</a></li>
          <li class="breadcrumb-item"><a href="index.html">Protocols</a></li>
      <li class="breadcrumb-item active">BGP</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../sources/configuration/protocols/bgp.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="bgp">
<span id="routing-bgp"></span><h1>BGP<a class="headerlink" href="#bgp" title="Link to this heading"></a></h1>
<p><abbr title="Border Gateway Protocol">BGP</abbr> is one of the Exterior Gateway Protocols
and the de facto standard interdomain routing protocol. The latest BGP version
is 4. BGP-4 is described in <span class="target" id="index-0"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1771.html"><strong>RFC 1771</strong></a> and updated by <span class="target" id="index-1"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4271.html"><strong>RFC 4271</strong></a>. <span class="target" id="index-2"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2858.html"><strong>RFC 2858</strong></a>
adds multiprotocol support to BGP.</p>
<p>VyOS makes use of <abbr title="Free Range Routing">FRR</abbr> and we would like to thank
them for their effort!</p>
<section id="basic-concepts">
<h2>Basic Concepts<a class="headerlink" href="#basic-concepts" title="Link to this heading"></a></h2>
<section id="autonomous-systems">
<span id="bgp-autonomous-systems"></span><h3>Autonomous Systems<a class="headerlink" href="#autonomous-systems" title="Link to this heading"></a></h3>
<p>From <span class="target" id="index-3"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1930.html"><strong>RFC 1930</strong></a>:</p>
<blockquote>
<div><p>An AS is a connected group of one or more IP prefixes run by one or more
network operators which has a SINGLE and CLEARLY DEFINED routing policy.</p>
</div></blockquote>
<p>Each <abbr title="Autonomous System">AS</abbr> has an identifying number associated with it
called an <abbr title="Autonomous System Number">ASN</abbr>. This is a two octet value
ranging in value from 1 to 65535. The AS numbers 64512 through 65535 are defined
as private AS numbers. Private AS numbers must not be advertised on the global
Internet. The 2-byte AS number range has been exhausted. 4-byte AS numbers are
specified in <span class="target" id="index-4"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc6793.html"><strong>RFC 6793</strong></a>, and provide a pool of 4294967296 AS numbers.</p>
<p>The <abbr title="Autonomous System Number">ASN</abbr> is one of the essential elements of
BGP. BGP is a distance vector routing protocol, and the AS-Path framework
provides distance vector metric and loop detection to BGP.</p>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-system-as-asn">
set protocols bgp system-as &lt;asn&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-system-as-asn" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Set local <abbr title="Autonomous System Number">ASN</abbr> that this router represents.
This is a a mandatory option!</p>
</div>
</div>
</section>
<section id="address-families">
<span id="bgp-address-families"></span><h3>Address Families<a class="headerlink" href="#address-families" title="Link to this heading"></a></h3>
<p>Multiprotocol extensions enable BGP to carry routing information for multiple
network layer protocols. BGP supports an Address Family Identifier (AFI) for
IPv4 and IPv6.</p>
</section>
<section id="route-selection">
<span id="bgp-route-selection"></span><h3>Route Selection<a class="headerlink" href="#route-selection" title="Link to this heading"></a></h3>
<p>The route selection process used by FRR’s BGP implementation uses the following
decision criterion, starting at the top of the list and going towards the
bottom until one of the factors can be used.</p>
<ol class="arabic">
<li><p><strong>Weight check</strong></p>
<p>Prefer higher local weight routes to lower routes.</p>
</li>
<li><p><strong>Local preference check</strong></p>
<p>Prefer higher local preference routes to lower.</p>
</li>
<li><p><strong>Local route check</strong></p>
<p>Prefer local routes (statics, aggregates, redistributed) to received routes.</p>
</li>
<li><p><strong>AS path length check</strong></p>
<p>Prefer shortest hop-count AS_PATHs.</p>
</li>
<li><p><strong>Origin check</strong></p>
<p>Prefer the lowest origin type route. That is, prefer IGP origin routes to
EGP, to Incomplete routes.</p>
</li>
<li><p><strong>MED check</strong></p>
<p>Where routes with a MED were received from the same AS, prefer the route
with the lowest MED.</p>
</li>
<li><p><strong>External check</strong></p>
<p>Prefer the route received from an external, eBGP peer over routes received
from other types of peers.</p>
</li>
<li><p><strong>IGP cost check</strong></p>
<p>Prefer the route with the lower IGP cost.</p>
</li>
<li><p><strong>Multi-path check</strong></p>
<p>If multi-pathing is enabled, then check whether the routes not yet
distinguished in preference may be considered equal. If
<code class="docutils literal notranslate"><span class="pre">bgp</span> <span class="pre">bestpath</span> <span class="pre">as-path</span> <span class="pre">multipath-relax</span></code> is set, all such routes are
considered equal, otherwise routes received via iBGP with identical AS_PATHs
or routes received from eBGP neighbours in the same AS are considered equal.</p>
</li>
<li><p><strong>Already-selected external check</strong></p>
<p>Where both routes were received from eBGP peers, then prefer the route
which is already selected. Note that this check is not applied if
<code class="docutils literal notranslate"><span class="pre">bgp</span> <span class="pre">bestpath</span> <span class="pre">compare-routerid</span></code> is configured. This check can
prevent some cases of oscillation.</p>
</li>
<li><p><strong>Router-ID check</strong></p>
<p>Prefer the route with the lowest <cite>router-ID</cite>. If the route has an
<cite>ORIGINATOR_ID</cite> attribute, through iBGP reflection, then that router ID is
used, otherwise the <cite>router-ID</cite> of the peer the route was received from is
used.</p>
</li>
<li><p><strong>Cluster-List length check</strong></p>
<p>The route with the shortest cluster-list length is used. The cluster-list
reflects the iBGP reflection path the route has taken.</p>
</li>
<li><p><strong>Peer address</strong></p>
<p>Prefer the route received from the peer with the higher transport layer
address, as a last-resort tie-breaker.</p>
</li>
</ol>
</section>
<section id="capability-negotiation">
<span id="bgp-capability-negotiation"></span><h3>Capability Negotiation<a class="headerlink" href="#capability-negotiation" title="Link to this heading"></a></h3>
<p>When adding IPv6 routing information exchange feature to BGP. There were some
proposals. <abbr title="Internet Engineering Task Force">IETF</abbr>
<abbr title="Inter Domain Routing">IDR</abbr> adopted a proposal called Multiprotocol
Extension for BGP. The specification is described in <span class="target" id="index-5"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2283.html"><strong>RFC 2283</strong></a>. The protocol
does not define new protocols. It defines new attributes to existing BGP. When
it is used exchanging IPv6 routing information it is called BGP-4+. When it is
used for exchanging multicast routing information it is called MBGP.</p>
<p><em>bgpd</em> supports Multiprotocol Extension for BGP. So if a remote peer supports
the protocol, <em>bgpd</em> can exchange IPv6 and/or multicast routing information.</p>
<p>Traditional BGP did not have the feature to detect a remote peer’s
capabilities, e.g. whether it can handle prefix types other than IPv4 unicast
routes. This was a big problem using Multiprotocol Extension for BGP in an
operational network. <span class="target" id="index-6"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2842.html"><strong>RFC 2842</strong></a> adopted a feature called Capability
Negotiation. <em>bgpd</em> use this Capability Negotiation to detect the remote peer’s
capabilities. If a peer is only configured as an IPv4 unicast neighbor, <em>bgpd</em>
does not send these Capability Negotiation packets (at least not unless other
optional BGP features require capability negotiation).</p>
<p>By default, FRR will bring up peering with minimal common capability for the
both sides. For example, if the local router has unicast and multicast
capabilities and the remote router only has unicast capability the local router
will establish the connection with unicast only capability. When there are no
common capabilities, FRR sends Unsupported Capability error and then resets the
connection.</p>
</section>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h2>
<section id="bgp-router-configuration">
<span id="id1"></span><h3>BGP Router Configuration<a class="headerlink" href="#bgp-router-configuration" title="Link to this heading"></a></h3>
<p>First of all you must configure BGP router with the <abbr title="Autonomous System Number">ASN</abbr>. The AS number is an identifier for the autonomous system.
The BGP protocol uses the AS number for detecting whether the BGP connection
is internal or external. VyOS does not have a special command to start the BGP
process. The BGP process starts when the first neighbor is configured.</p>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-system-as-asn">
set protocols bgp system-as &lt;asn&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-system-as-asn" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Set local autonomous system number that this router represents. This is a
mandatory option!</p>
</div>
</div>
<section id="peers-configuration">
<h4>Peers Configuration<a class="headerlink" href="#peers-configuration" title="Link to this heading"></a></h4>
<section id="defining-peers">
<h5>Defining Peers<a class="headerlink" href="#defining-peers" title="Link to this heading"></a></h5>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-remote-as-nasn">
set protocols bgp neighbor &lt;address|interface&gt; remote-as &lt;nasn&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-remote-as-nasn" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command creates a new neighbor whose remote-as is &lt;nasn&gt;. The neighbor
address can be an IPv4 address or an IPv6 address or an interface to use
for the connection. The command is applicable for peer and peer group.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-remote-as-internal">
set protocols bgp neighbor &lt;address|interface&gt; remote-as internal</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-remote-as-internal" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Create a peer as you would when you specify an ASN, except that if the
peers ASN is different than mine as specified under the <code class="docutils literal notranslate"><span class="pre">protocols</span>
<span class="pre">bgp</span> <span class="pre">&lt;asn&gt;</span></code> command the connection will be denied.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-remote-as-external">
set protocols bgp neighbor &lt;address|interface&gt; remote-as external</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-remote-as-external" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Create a peer as you would when you specify an ASN, except that if the
peers ASN is the same as mine as specified under the <code class="docutils literal notranslate"><span class="pre">protocols</span>
<span class="pre">bgp</span> <span class="pre">&lt;asn&gt;</span></code> command the connection will be denied.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-local-role-role-strict">
set protocols bgp neighbor &lt;address|interface&gt; local-role &lt;role&gt; [strict]</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-local-role-role-strict" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>BGP roles are defined in RFC <span class="target" id="index-7"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc9234.html"><strong>RFC 9234</strong></a> and provide an easy way to
add route leak prevention, detection and mitigation. The local Role
value is negotiated with the new BGP Role capability which has a
built-in check of the corresponding value. In case of a mismatch the
new OPEN Roles Mismatch Notification &lt;2, 11&gt; would be sent.
The correct Role pairs are:</p>
<p>Provider - Customer</p>
<p>Peer - Peer</p>
<p>RS-Server - RS-Client</p>
<p>If <code class="docutils literal notranslate"><span class="pre">strict</span></code> is set the BGP session won’t become established
until the BGP neighbor sets local Role on its side. This
configuration parameter is defined in RFC <span class="target" id="index-8"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc9234.html"><strong>RFC 9234</strong></a> and is used to
enforce the corresponding configuration at your counter-parts side.</p>
<p>Routes that are sent from provider, rs-server, or the peer local-role
(or if received by customer, rs-client, or the peer local-role) will
be marked with a new Only to Customer (OTC) attribute.</p>
<p>Routes with this attribute can only be sent to your neighbor if your
local-role is provider or rs-server. Routes with this attribute can
be received only if your local-role is customer or rs-client.</p>
<p>In case of peer-peer relationship routes can be received only if OTC
value is equal to your neighbor AS number.</p>
<p>All these rules with OTC will help to detect and mitigate route leaks
and happen automatically if local-role is set.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-shutdown">
set protocols bgp neighbor &lt;address|interface&gt; shutdown</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-shutdown" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command disable the peer or peer group. To reenable the peer use
the delete form of this command.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-description-text">
set protocols bgp neighbor &lt;address|interface&gt; description &lt;text&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-description-text" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Set description of the peer or peer group.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-update-source-address-interface">
set protocols bgp neighbor &lt;address|interface&gt; update-source &lt;address|interface&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-update-source-address-interface" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Specify the IPv4 source address to use for the BGP session to this neighbor,
may be specified as either an IPv4 address directly or as an interface name.</p>
</div>
</div>
</section>
<section id="id2">
<span id="id3"></span><h5>Capability Negotiation<a class="headerlink" href="#id2" title="Link to this heading"></a></h5>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-capability-dynamic">
set protocols bgp neighbor &lt;address|interface&gt; capability dynamic</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-capability-dynamic" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command would allow the dynamic update of capabilities over an
established BGP session.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-capability-extended-nexthop">
set protocols bgp neighbor &lt;address|interface&gt; capability extended-nexthop</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-capability-extended-nexthop" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Allow bgp to negotiate the extended-nexthop capability with it’s peer.
If you are peering over a IPv6 Link-Local address then this capability
is turned on automatically. If you are peering over a IPv6 Global Address
then turning on this command will allow BGP to install IPv4 routes with
IPv6 nexthops if you do not have IPv4 configured on interfaces.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-disable-capability-negotiation">
set protocols bgp neighbor &lt;address|interface&gt; disable-capability-negotiation</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-disable-capability-negotiation" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Suppress sending Capability Negotiation as OPEN message optional
parameter to the peer. This command only affects the peer is
configured other than IPv4 unicast configuration.</p>
<p>When remote peer does not have capability negotiation feature,
remote peer will not send any capabilities at all. In that case,
bgp configures the peer with configured capabilities.</p>
<p>You may prefer locally configured capabilities more than the negotiated
capabilities even though remote peer sends capabilities. If the peer is
configured by <code class="docutils literal notranslate"><span class="pre">override-capability</span></code>, VyOS ignores received
capabilities then override negotiated capabilities with configured values.</p>
<p>Additionally you should keep in mind that this feature fundamentally
disables the ability to use widely deployed BGP features. BGP unnumbered,
hostname support, AS4, Addpath, Route Refresh, ORF, Dynamic Capabilities,
and graceful restart.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-override-capability">
set protocols bgp neighbor &lt;address|interface&gt; override-capability</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-override-capability" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command allow override the result of Capability Negotiation with
local configuration. Ignore remote peer’s capability value.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-strict-capability-match">
set protocols bgp neighbor &lt;address|interface&gt; strict-capability-match</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-strict-capability-match" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command forces strictly compare remote capabilities and local
capabilities. If capabilities are different, send Unsupported Capability
error then reset connection.</p>
<p>You may want to disable sending Capability Negotiation OPEN message
optional parameter to the peer when remote peer does not implement
Capability Negotiation. Please use <code class="docutils literal notranslate"><span class="pre">disable-capability-negotiation</span></code>
command to disable the feature.</p>
</div>
</div>
</section>
<section id="peer-parameters">
<h5>Peer Parameters<a class="headerlink" href="#peer-parameters" title="Link to this heading"></a></h5>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-allowas-in-number-number">
set protocols bgp neighbor &lt;address|interface&gt; address-family &lt;ipv4-unicast|ipv6-unicast&gt; allowas-in number &lt;number&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-allowas-in-number-number" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command accept incoming routes with AS path containing AS
number with the same value as the current system AS. This is
used when you want to use the same AS number in your sites,
but you can’t connect them directly.</p>
<p>The number parameter (1-10) configures the amount of accepted
occurences of the system AS number in AS path.</p>
<p>This command is only allowed for eBGP peers. It is not applicable
for peer groups.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-as-override">
set protocols bgp neighbor &lt;address|interface&gt; address-family &lt;ipv4-unicast|ipv6-unicast&gt; as-override</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-as-override" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command override AS number of the originating router with
the local AS number.</p>
<p>Usually this configuration is used in PEs (Provider Edge) to
replace the incoming customer AS number so the connected CE (
Customer Edge) can use the same AS number as the other customer
sites. This allows customers of the provider network to use the
same AS number across their sites.</p>
<p>This command is only allowed for eBGP peers.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-attribute-unchanged-as-path-med-next-hop">
set protocols bgp neighbor &lt;address|interface&gt; address-family &lt;ipv4-unicast|ipv6-unicast&gt; attribute-unchanged &lt;as-path|med|next-hop&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-attribute-unchanged-as-path-med-next-hop" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies attributes to be left unchanged for
advertisements sent to a peer or peer group.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-maximum-prefix-number">
set protocols bgp neighbor &lt;address|interface&gt; address-family &lt;ipv4-unicast|ipv6-unicast&gt; maximum-prefix &lt;number&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-maximum-prefix-number" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies a maximum number of prefixes we can receive
from a given peer. If this number is exceeded, the BGP session
will be destroyed. The number range is 1 to 4294967295.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-nexthop-self">
set protocols bgp neighbor &lt;address|interface&gt; address-family &lt;ipv4-unicast|ipv6-unicast&gt; nexthop-self</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-nexthop-self" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command forces the BGP speaker to report itself as the
next hop for an advertised route it advertised to a neighbor.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-remove-private-as">
set protocols bgp neighbor &lt;address|interface&gt; address-family &lt;ipv4-unicast|ipv6-unicast&gt; remove-private-as</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-remove-private-as" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command removes the private ASN of routes that are advertised
to the configured peer. It removes only private ASNs on routes
advertised to EBGP peers.</p>
<p>If the AS-Path for the route has only private ASNs, the private
ASNs are removed.</p>
<p>If the AS-Path for the route has a private ASN between public
ASNs, it is assumed that this is a design choice, and the
private ASN is not removed.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-soft-reconfiguration-inbound">
set protocols bgp neighbor &lt;address|interface&gt; address-family &lt;ipv4-unicast|ipv6-unicast&gt; soft-reconfiguration inbound</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-soft-reconfiguration-inbound" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Changes in BGP policies require the BGP session to be cleared. Clearing has a
large negative impact on network operations. Soft reconfiguration enables you
to generate inbound updates from a neighbor, change and activate BGP policies
without clearing the BGP session.</p>
<p>This command specifies that route updates received from this neighbor will be
stored unmodified, regardless of the inbound policy. When inbound soft
reconfiguration is enabled, the stored updates are processed by the new
policy configuration to create new inbound updates.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Storage of route updates uses memory. If you enable soft
reconfiguration inbound for multiple neighbors, the amount of memory used
can become significant.</p>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-weight-number">
set protocols bgp neighbor &lt;address|interface&gt; address-family &lt;ipv4-unicast|ipv6-unicast&gt; weight &lt;number&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-weight-number" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies a default weight value for the neighbor’s
routes. The number range is 1 to 65535.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-advertisement-interval-seconds">
set protocols bgp neighbor &lt;address|interface&gt; advertisement-interval &lt;seconds&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-advertisement-interval-seconds" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies the minimum route advertisement interval for
the peer. The interval value is 0 to 600 seconds, with the default
advertisement interval being 0.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-disable-connected-check">
set protocols bgp neighbor &lt;address|interface&gt; disable-connected-check</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-disable-connected-check" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command allows peerings between directly connected eBGP peers
using loopback addresses without adjusting the default TTL of 1.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-disable-send-community-extended-standard">
set protocols bgp neighbor &lt;address|interface&gt; disable-send-community &lt;extended|standard&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-disable-send-community-extended-standard" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies that the community attribute should not be sent
in route updates to a peer. By default community attribute is sent.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-ebgp-multihop-number">
set protocols bgp neighbor &lt;address|interface&gt; ebgp-multihop &lt;number&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-ebgp-multihop-number" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command allows sessions to be established with eBGP neighbors
when they are multiple hops away. When the neighbor is not directly
connected and this knob is not enabled, the session will not establish.
The number of hops range is 1 to 255. This command is mutually
exclusive with <code class="docutils literal notranslate"><span class="pre">ttl-security</span> <span class="pre">hops</span></code>.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-local-as-asn-no-prepend-replace-as">
set protocols bgp neighbor &lt;address|interface&gt; local-as &lt;asn&gt; [no-prepend] [replace-as]</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-local-as-asn-no-prepend-replace-as" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Specify an alternate AS for this BGP process when interacting with
the specified peer or peer group. With no modifiers, the specified
local-as is prepended to the received AS_PATH when receiving routing
updates from the peer, and prepended to the outgoing AS_PATH (after
the process local AS) when transmitting local routes to the peer.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">no-prepend</span></code> attribute is specified, then the supplied
local-as is not prepended to the received AS_PATH.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">replace-as</span></code> attribute is specified, then only the supplied
local-as is prepended to the AS_PATH when transmitting local-route
updates to this peer.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command is only allowed for eBGP peers.</p>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-passive">
set protocols bgp neighbor &lt;address|interface&gt; passive</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-passive" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Configures the BGP speaker so that it only accepts inbound connections
from, but does not initiate outbound connections to the peer or peer group.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-password-text">
set protocols bgp neighbor &lt;address|interface&gt; password &lt;text&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-password-text" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies a MD5 password to be used with the tcp socket that
is being used to connect to the remote peer.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-ttl-security-hops-number">
set protocols bgp neighbor &lt;address|interface&gt; ttl-security hops &lt;number&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-ttl-security-hops-number" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command enforces Generalized TTL Security Mechanism (GTSM),
as specified in <span class="target" id="index-9"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5082.html"><strong>RFC 5082</strong></a>. With this command, only neighbors
that are specified number of hops away will be allowed to
become neighbors. The number of hops range is 1 to 254. This
command is mutually exclusive with <code class="docutils literal notranslate"><span class="pre">ebgp-multihop</span></code>.</p>
</div>
</div>
</section>
<section id="peer-groups">
<h5>Peer Groups<a class="headerlink" href="#peer-groups" title="Link to this heading"></a></h5>
<p>Peer groups are used to help improve scaling by generating the same update
information to all members of a peer group. Note that this means that the
routes generated by a member of a peer group will be sent back to that
originating peer with the originator identifier attribute set to indicated
the originating peer. All peers not associated with a specific peer group
are treated as belonging to a default peer group, and will share updates.</p>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-peer-group-name">
set protocols bgp peer-group &lt;name&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-peer-group-name" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command defines a new peer group. You can specify to the group the same
parameters that you can specify for specific neighbors.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you apply a parameter to an individual neighbor IP address, you
override the action defined for a peer group that includes that IP
address.</p>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-peer-group-name">
set protocols bgp neighbor &lt;address|interface&gt; peer-group &lt;name&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-peer-group-name" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command bind specific peer to peer group with a given name.</p>
</div>
</div>
</section>
</section>
<section id="network-advertisement-configuration">
<h4>Network Advertisement Configuration<a class="headerlink" href="#network-advertisement-configuration" title="Link to this heading"></a></h4>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-address-family-ipv4-unicast-ipv6-unicast-network-prefix">
set protocols bgp address-family &lt;ipv4-unicast|ipv6-unicast&gt; network &lt;prefix&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-address-family-ipv4-unicast-ipv6-unicast-network-prefix" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command is used for advertising IPv4 or IPv6 networks.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, the BGP prefix is advertised even if it’s not present
in the routing table. This behaviour differs from the implementation of
some vendors.</p>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-network-import-check">
set protocols bgp parameters network-import-check</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-network-import-check" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This configuration modifies the behavior of the network statement. If you
have this configured the underlying network must exist in the routing table.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-default-originate-route-map-name">
set protocols bgp neighbor &lt;address|interface&gt; address-family &lt;ipv4-unicast|ipv6-unicast&gt; default-originate [route-map &lt;name&gt;]</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-default-originate-route-map-name" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>By default, VyOS does not advertise a default route (0.0.0.0/0) even if it is
in routing table. When you want to announce default routes to the peer, use
this command. Using optional argument <code class="docutils literal notranslate"><span class="pre">route-map</span></code> you can inject the
default route to given neighbor only if the conditions in the route map are
met.</p>
</div>
</div>
</section>
<section id="route-aggregation-configuration">
<h4>Route Aggregation Configuration<a class="headerlink" href="#route-aggregation-configuration" title="Link to this heading"></a></h4>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-address-family-ipv4-unicast-ipv6-unicast-aggregate-address-prefix">
set protocols bgp address-family &lt;ipv4-unicast|ipv6-unicast&gt; aggregate-address &lt;prefix&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-address-family-ipv4-unicast-ipv6-unicast-aggregate-address-prefix" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies an aggregate address. The router will also
announce longer-prefixes inside of the aggregate address.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-address-family-ipv4-unicast-ipv6-unicast-aggregate-address-prefix-as-set">
set protocols bgp address-family &lt;ipv4-unicast|ipv6-unicast&gt; aggregate-address &lt;prefix&gt; as-set</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-address-family-ipv4-unicast-ipv6-unicast-aggregate-address-prefix-as-set" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies an aggregate address with a mathematical set of
autonomous systems. This command summarizes the AS_PATH attributes of
all the individual routes.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-address-family-ipv4-unicast-ipv6-unicast-aggregate-address-prefix-summary-only">
set protocols bgp address-family &lt;ipv4-unicast|ipv6-unicast&gt; aggregate-address &lt;prefix&gt; summary-only</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-address-family-ipv4-unicast-ipv6-unicast-aggregate-address-prefix-summary-only" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies an aggregate address and provides that
longer-prefixes inside of the aggregate address are suppressed
before sending BGP updates out to peers.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-unsuppress-map-name">
set protocols bgp neighbor &lt;address|interface&gt; address-family &lt;ipv4-unicast|ipv6-unicast&gt; unsuppress-map &lt;name&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-unsuppress-map-name" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command applies route-map to selectively unsuppress prefixes
suppressed by summarisation.</p>
</div>
</div>
</section>
<section id="redistribution-configuration">
<h4>Redistribution Configuration<a class="headerlink" href="#redistribution-configuration" title="Link to this heading"></a></h4>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-address-family-ipv4-unicast-ipv6-unicast-redistribute-route-source">
set protocols bgp address-family &lt;ipv4-unicast|ipv6-unicast&gt; redistribute &lt;route source&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-address-family-ipv4-unicast-ipv6-unicast-redistribute-route-source" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command redistributes routing information from the given route source
to the BGP process. There are six modes available for route source:
connected, kernel, ospf, rip, static, table.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-address-family-ipv4-unicast-ipv6-unicast-redistribute-route-source-metric-number">
set protocols bgp address-family &lt;ipv4-unicast|ipv6-unicast&gt; redistribute &lt;route source&gt; metric &lt;number&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-address-family-ipv4-unicast-ipv6-unicast-redistribute-route-source-metric-number" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies metric (MED) for redistributed routes. The
metric range is 0 to 4294967295. There are six modes available for
route source: connected, kernel, ospf, rip, static, table.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-address-family-ipv4-unicast-ipv6-unicast-redistribute-route-source-route-map-name">
set protocols bgp address-family &lt;ipv4-unicast|ipv6-unicast&gt; redistribute &lt;route source&gt; route-map &lt;name&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-address-family-ipv4-unicast-ipv6-unicast-redistribute-route-source-route-map-name" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command allows to use route map to filter redistributed routes.
There are six modes available for route source: connected, kernel,
ospf, rip, static, table.</p>
</div>
</div>
</section>
<section id="general-configuration">
<h4>General Configuration<a class="headerlink" href="#general-configuration" title="Link to this heading"></a></h4>
<section id="common-parameters">
<h5>Common parameters<a class="headerlink" href="#common-parameters" title="Link to this heading"></a></h5>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-allow-martian-nexthop">
set protocols bgp parameters allow-martian-nexthop</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-allow-martian-nexthop" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>When a peer receives a martian nexthop as part of the NLRI for a route
permit the nexthop to be used as such, instead of rejecting and resetting
the connection.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-router-id-id">
set protocols bgp parameters router-id &lt;id&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-router-id-id" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies the router-ID. If router ID is not specified it will
use the highest interface IP address.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-address-family-ipv4-unicast-ipv6-unicast-maximum-paths-ebgp-ibgp-number">
set protocols bgp address-family &lt;ipv4-unicast|ipv6-unicast&gt; maximum-paths &lt;ebgp|ibgp&gt; &lt;number&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-address-family-ipv4-unicast-ipv6-unicast-maximum-paths-ebgp-ibgp-number" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command defines the maximum number of parallel routes that
the BGP can support. In order for BGP to use the second path, the
following attributes have to match: Weight, Local Preference, AS
Path (both AS number and AS path length), Origin code, MED, IGP
metric. Also, the next hop address for each path must be different.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-no-hard-administrative-reset">
set protocols bgp parameters no-hard-administrative-reset</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-no-hard-administrative-reset" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Do not send Hard Reset CEASE Notification for “Administrative Reset”
events. When set and Graceful Restart Notification capability is exchanged
between the peers, Graceful Restart procedures apply, and routes will be retained.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-log-neighbor-changes">
set protocols bgp parameters log-neighbor-changes</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-log-neighbor-changes" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command enable logging neighbor up/down changes and reset reason.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-no-client-to-client-reflection">
set protocols bgp parameters no-client-to-client-reflection</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-no-client-to-client-reflection" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command disables route reflection between route reflector clients.
By default, the clients of a route reflector are not required to be
fully meshed and the routes from a client are reflected to other clients.
However, if the clients are fully meshed, route reflection is not required.
In this case, use the <code class="docutils literal notranslate"><span class="pre">no-client-to-client-reflection</span></code> command
to disable client-to-client reflection.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-no-fast-external-failover">
set protocols bgp parameters no-fast-external-failover</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-no-fast-external-failover" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Disable immediate session reset if peer’s connected link goes down.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-listen-range-prefix-peer-group-name">
set protocols bgp listen range &lt;prefix&gt; peer-group &lt;name&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-listen-range-prefix-peer-group-name" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command is useful if one desires to loosen the requirement for BGP
to have strictly defined neighbors. Specifically what is allowed is for
the local router to listen to a range of IPv4 or IPv6 addresses defined
by a prefix and to accept BGP open messages. When a TCP connection
(and subsequently a BGP open message) from within this range tries to
connect the local router then the local router will respond and connect
with the parameters that are defined within the peer group. One must define
a peer-group for each range that is listed. If no peer-group is defined
then an error will keep you from committing the configuration.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-listen-limit-number">
set protocols bgp listen limit &lt;number&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-listen-limit-number" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command goes hand in hand with the listen range command to limit the
amount of BGP neighbors that are allowed to connect to the local router.
The limit range is 1 to 5000.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-ebgp-requires-policy">
set protocols bgp parameters ebgp-requires-policy</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-ebgp-requires-policy" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command changes the eBGP behavior of FRR. By default FRR enables
<span class="target" id="index-10"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc8212.html"><strong>RFC 8212</strong></a> functionality which affects how eBGP routes are advertised,
namely no routes are advertised across eBGP sessions without some
sort of egress route-map/policy in place. In VyOS however we have this
RFC functionality disabled by default so that we can preserve backwards
compatibility with older versions of VyOS. With this option one can
enable <span class="target" id="index-11"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc8212.html"><strong>RFC 8212</strong></a> functionality to operate.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-labeled-unicast-explicit-null-ipv4-explicit-null-ipv6-explicit-null">
set protocols bgp parameters labeled-unicast &lt;explicit-null | ipv4-explicit-null | ipv6-explicit-null&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-labeled-unicast-explicit-null-ipv4-explicit-null-ipv6-explicit-null" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>By default, locally advertised prefixes use the implicit-null label to
encode in the outgoing NLRI.</p>
<p>The following command uses the explicit-null label value for all the
BGP instances.</p>
</div>
</div>
</section>
<section id="administrative-distance">
<h5>Administrative Distance<a class="headerlink" href="#administrative-distance" title="Link to this heading"></a></h5>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-distance-global-external-internal-local-distance">
set protocols bgp parameters distance global &lt;external|internal|local&gt; &lt;distance&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-distance-global-external-internal-local-distance" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command change distance value of BGP. The arguments are the distance
values for external routes, internal routes and local routes respectively.
The distance range is 1 to 255.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-distance-prefix-subnet-distance-distance">
set protocols bgp parameters distance prefix &lt;subnet&gt; distance &lt;distance&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-distance-prefix-subnet-distance-distance" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command sets the administrative distance for a particular route. The
distance range is 1 to 255.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Routes with a distance of 255 are effectively disabled and not
installed into the kernel.</p>
</div>
</div>
</div>
</section>
<section id="timers">
<h5>Timers<a class="headerlink" href="#timers" title="Link to this heading"></a></h5>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-timers-holdtime-seconds">
set protocols bgp timers holdtime &lt;seconds&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-timers-holdtime-seconds" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies hold-time in seconds. The timer range is
4 to 65535. The default value is 180 second. If you set value to 0
VyOS will not hold routes.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-timers-keepalive-seconds">
set protocols bgp timers keepalive &lt;seconds&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-timers-keepalive-seconds" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies keep-alive time in seconds. The timer
can range from 4 to 65535. The default value is 60 second.</p>
</div>
</div>
</section>
<section id="route-dampening">
<h5>Route Dampening<a class="headerlink" href="#route-dampening" title="Link to this heading"></a></h5>
<p>When a route fails, a routing update is sent to withdraw the route from the
network’s routing tables. When the route is re-enabled, the change in
availability is also advertised. A route that continually fails and returns
requires a great deal of network traffic to update the network about the
route’s status.</p>
<p>Route dampening wich described in <span class="target" id="index-12"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2439.html"><strong>RFC 2439</strong></a> enables you to identify routes
that repeatedly fail and return. If route dampening is enabled, an unstable
route accumulates penalties each time the route fails and returns. If the
accumulated penalties exceed a threshold, the route is no longer advertised.
This is route suppression. Routes that have been suppressed are re-entered
into the routing table only when the amount of their penalty falls below a
threshold.</p>
<p>A penalty of 1000 is assessed each time the route fails. When the penalties
reach a predefined threshold (suppress-value), the router stops advertising
the route.</p>
<p>Once a route is assessed a penalty, the penalty is decreased by half each time
a predefined amount of time elapses (half-life-time). When the accumulated
penalties fall below a predefined threshold (reuse-value), the route is
unsuppressed and added back into the BGP routing table.</p>
<p>No route is suppressed indefinitely. Maximum-suppress-time defines the maximum
time a route can be suppressed before it is re-advertised.</p>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-dampening-half-life-minutes">
set protocols bgp parameters dampening half-life &lt;minutes&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-dampening-half-life-minutes" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command defines the amount of time in minutes after
which a penalty is reduced by half. The timer range is
10 to 45 minutes.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-dampening-re-use-seconds">
set protocols bgp parameters dampening re-use &lt;seconds&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-dampening-re-use-seconds" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command defines the accumulated penalty amount at which the
route is re-advertised. The penalty range is 1 to 20000.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-dampening-start-suppress-time-seconds">
set protocols bgp parameters dampening start-suppress-time &lt;seconds&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-dampening-start-suppress-time-seconds" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command defines the accumulated penalty amount at which the
route is suppressed. The penalty range is 1 to 20000.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-dampening-max-suppress-time-seconds">
set protocols bgp parameters dampening max-suppress-time &lt;seconds&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-dampening-max-suppress-time-seconds" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command defines the maximum time in minutes that a route is
suppressed. The timer range is 1 to 255 minutes.</p>
</div>
</div>
</section>
</section>
<section id="route-selection-configuration">
<h4>Route Selection Configuration<a class="headerlink" href="#route-selection-configuration" title="Link to this heading"></a></h4>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-always-compare-med">
set protocols bgp parameters always-compare-med</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-always-compare-med" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command provides to compare the MED on routes, even when they were
received from different neighbouring ASes. Setting this option makes the
order of preference of routes more defined, and should eliminate MED
induced oscillations.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-bestpath-as-path-confed">
set protocols bgp parameters bestpath as-path confed</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-bestpath-as-path-confed" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies that the length of confederation path sets and
sequences should be taken into account during the BGP best path
decision process.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-bestpath-as-path-multipath-relax">
set protocols bgp parameters bestpath as-path multipath-relax</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-bestpath-as-path-multipath-relax" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies that BGP decision process should consider paths
of equal AS_PATH length candidates for multipath computation. Without
the knob, the entire AS_PATH must match for multipath computation.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-bestpath-as-path-ignore">
set protocols bgp parameters bestpath as-path ignore</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-bestpath-as-path-ignore" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Ignore AS_PATH length when selecting a route</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-bestpath-compare-routerid">
set protocols bgp parameters bestpath compare-routerid</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-bestpath-compare-routerid" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Ensure that when comparing routes where both are equal on most metrics,
including local-pref, AS_PATH length, IGP cost, MED, that the tie is
broken based on router-ID.</p>
<p>If this option is enabled, then the already-selected check, where
already selected eBGP routes are preferred, is skipped.</p>
<p>If a route has an ORIGINATOR_ID attribute because it has been reflected,
that ORIGINATOR_ID will be used. Otherwise, the router-ID of the peer
the route was received from will be used.</p>
<p>The advantage of this is that the route-selection (at this point) will
be more deterministic. The disadvantage is that a few or even one lowest-ID
router may attract all traffic to otherwise-equal paths because of this
check. It may increase the possibility of MED or IGP oscillation, unless
other measures were taken to avoid these. The exact behaviour will be
sensitive to the iBGP and reflection topology.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-bestpath-med-confed">
set protocols bgp parameters bestpath med confed</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-bestpath-med-confed" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies that BGP considers the MED when comparing routes
originated from different sub-ASs within the confederation to which this
BGP speaker belongs. The default state, where the MED attribute is not
considered.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-bestpath-med-missing-as-worst">
set protocols bgp parameters bestpath med missing-as-worst</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-bestpath-med-missing-as-worst" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies that a route with a MED is always considered to be
better than a route without a MED by causing the missing MED attribute to
have a value of infinity. The default state, where the missing MED
attribute is considered to have a value of zero.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-default-local-pref-local-pref-value">
set protocols bgp parameters default local-pref &lt;local-pref value&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-default-local-pref-local-pref-value" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies the default local preference value. The local
preference range is 0 to 4294967295.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-deterministic-med">
set protocols bgp parameters deterministic-med</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-deterministic-med" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command provides to compare different MED values that advertised by
neighbours in the same AS for routes selection. When this command is
enabled, routes from the same autonomous system are grouped together, and
the best entries of each group are compared.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-address-family-ipv4-unicast-network-prefix-backdoor">
set protocols bgp address-family ipv4-unicast network &lt;prefix&gt; backdoor</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-address-family-ipv4-unicast-network-prefix-backdoor" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command allows the router to prefer route to specified prefix learned
via IGP through backdoor link instead of a route to the same prefix learned
via EBGP.</p>
</div>
</div>
</section>
<section id="route-filtering-configuration">
<h4>Route Filtering Configuration<a class="headerlink" href="#route-filtering-configuration" title="Link to this heading"></a></h4>
<p>In order to control and modify routing information that is exchanged between
peers you can use route-map, filter-list, prefix-list, distribute-list.</p>
<p>For inbound updates the order of preference is:</p>
<blockquote>
<div><ul class="simple">
<li><p>route-map</p></li>
<li><p>filter-list</p></li>
<li><p>prefix-list, distribute-list</p></li>
</ul>
</div></blockquote>
<p>For outbound updates the order of preference is:</p>
<blockquote>
<div><ul class="simple">
<li><p>prefix-list, distribute-list</p></li>
<li><p>filter-list</p></li>
<li><p>route-map</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The attributes <code class="docutils literal notranslate"><span class="pre">prefix-list</span></code> and <code class="docutils literal notranslate"><span class="pre">distribute-list</span></code>
are mutually exclusive, and only one command (distribute-list or
prefix-list) can be applied to each inbound or outbound direction for a
particular neighbor.</p>
</div>
</div></blockquote>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-distribute-list-export-import-number">
set protocols bgp neighbor &lt;address|interface&gt; address-family &lt;ipv4-unicast|ipv6-unicast&gt; distribute-list &lt;export|import&gt; &lt;number&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-distribute-list-export-import-number" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command applies the access list filters named in &lt;number&gt; to the
specified BGP neighbor to restrict the routing information that BGP learns
and/or advertises. The arguments <code class="docutils literal notranslate"><span class="pre">export</span></code> and <code class="docutils literal notranslate"><span class="pre">import</span></code>
specify the direction in which the access list are applied.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-prefix-list-export-import-name">
set protocols bgp neighbor &lt;address|interface&gt; address-family &lt;ipv4-unicast|ipv6-unicast&gt; prefix-list &lt;export|import&gt; &lt;name&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-prefix-list-export-import-name" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command applies the prfefix list filters named in &lt;name&gt; to the
specified BGP neighbor to restrict the routing information that BGP learns
and/or advertises. The arguments <code class="docutils literal notranslate"><span class="pre">export</span></code> and <code class="docutils literal notranslate"><span class="pre">import</span></code>
specify the direction in which the prefix list are applied.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-route-map-export-import-name">
set protocols bgp neighbor &lt;address|interface&gt; address-family &lt;ipv4-unicast|ipv6-unicast&gt; route-map &lt;export|import&gt; &lt;name&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-route-map-export-import-name" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command applies the route map named in &lt;name&gt; to the specified BGP
neighbor to control and modify routing information that is exchanged
between peers. The arguments <code class="docutils literal notranslate"><span class="pre">export</span></code> and <code class="docutils literal notranslate"><span class="pre">import</span></code>
specify the direction in which the route map are applied.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-filter-list-export-import-name">
set protocols bgp neighbor &lt;address|interface&gt; address-family &lt;ipv4-unicast|ipv6-unicast&gt; filter-list &lt;export|import&gt; &lt;name&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-filter-list-export-import-name" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command applies the AS path access list filters named in &lt;name&gt; to the
specified BGP neighbor to restrict the routing information that BGP learns
and/or advertises. The arguments <code class="docutils literal notranslate"><span class="pre">export</span></code> and <code class="docutils literal notranslate"><span class="pre">import</span></code>
specify the direction in which the AS path access list are applied.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-capability-orf-receive-send">
set protocols bgp neighbor &lt;address|interface&gt; address-family &lt;ipv4-unicast|ipv6-unicast&gt; capability orf &lt;receive|send&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-address-family-ipv4-unicast-ipv6-unicast-capability-orf-receive-send" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command enables the ORF capability (described in <span class="target" id="index-13"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5291.html"><strong>RFC 5291</strong></a>) on the
local router, and enables ORF capability advertisement to the specified BGP
peer. The <code class="docutils literal notranslate"><span class="pre">receive</span></code> keyword configures a router to advertise ORF
receive capabilities. The <code class="docutils literal notranslate"><span class="pre">send</span></code> keyword configures a router to
advertise ORF send capabilities. To advertise a filter from a sender, you
must create an IP prefix list for the specified BGP peer applied in inbound
derection.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-interface-solo">
set protocols bgp neighbor &lt;address|interface&gt; solo</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-interface-solo" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command prevents from sending back prefixes learned from the neighbor.</p>
</div>
</div>
</section>
<section id="bgp-scaling-configuration">
<h4>BGP Scaling Configuration<a class="headerlink" href="#bgp-scaling-configuration" title="Link to this heading"></a></h4>
<p>BGP routers connected inside the same AS through BGP belong to an internal BGP
session, or IBGP. In order to prevent routing table loops, IBGP speaker does
not advertise IBGP-learned routes to other IBGP speaker (Split Horizon
mechanism). As such, IBGP requires a full mesh of all peers. For large
networks, this quickly becomes unscalable.</p>
<p>There are two ways that help us to mitigate the BGPs full-mesh requirement in
a network:</p>
<blockquote>
<div><ul class="simple">
<li><p>Using BGP route-reflectors</p></li>
<li><p>Using BGP confederation</p></li>
</ul>
</div></blockquote>
<section id="route-reflector-configuration">
<h5>Route Reflector Configuration<a class="headerlink" href="#route-reflector-configuration" title="Link to this heading"></a></h5>
<p>Introducing route reflectors removes the need for the full-mesh. When you
configure a route reflector you have to tell the router whether the other IBGP
router is a client or non-client. A client is an IBGP router that the route
reflector will “reflect” routes to, the non-client is just a regular IBGP
neighbor. Route reflectors mechanism is described in <span class="target" id="index-14"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4456.html"><strong>RFC 4456</strong></a> and updated
by <span class="target" id="index-15"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7606.html"><strong>RFC 7606</strong></a>.</p>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-neighbor-address-address-family-ipv4-unicast-ipv6-unicast-route-reflector-client">
set protocols bgp neighbor &lt;address&gt; address-family &lt;ipv4-unicast|ipv6-unicast&gt; route-reflector-client</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-neighbor-address-address-family-ipv4-unicast-ipv6-unicast-route-reflector-client" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies the given neighbor as route reflector client.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-cluster-id-id">
set protocols bgp parameters cluster-id &lt;id&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-cluster-id-id" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies cluster ID which identifies a collection of route
reflectors and their clients, and is used by route reflectors to avoid
looping. By default cluster ID is set to the BGP router id value, but can be
set to an arbitrary 32-bit value.</p>
</div>
</div>
</section>
<section id="confederation-configuration">
<h5>Confederation Configuration<a class="headerlink" href="#confederation-configuration" title="Link to this heading"></a></h5>
<p>A BGP confederation divides our AS into sub-ASes to reduce the number of
required IBGP peerings. Within a sub-AS we still require full-mesh IBGP but
between these sub-ASes we use something that looks like EBGP but behaves like
IBGP (called confederation BGP). Confederation mechanism is described in
<span class="target" id="index-16"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5065.html"><strong>RFC 5065</strong></a></p>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-confederation-identifier-asn">
set protocols bgp parameters confederation identifier &lt;asn&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-confederation-identifier-asn" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command specifies a BGP confederation identifier. &lt;asn&gt; is the number
of the autonomous system that internally includes multiple sub-autonomous
systems (a confederation).</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-protocols-bgp-parameters-confederation-peers-nsubasn">
set protocols bgp parameters confederation peers &lt;nsubasn&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-protocols-bgp-parameters-confederation-peers-nsubasn" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>This command sets other confederations &lt;nsubasn&gt; as members of autonomous
system specified by <code class="docutils literal notranslate"><span class="pre">confederation</span> <span class="pre">identifier</span> <span class="pre">&lt;asn&gt;</span></code>.</p>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="operational-mode-commands">
<h2>Operational Mode Commands<a class="headerlink" href="#operational-mode-commands" title="Link to this heading"></a></h2>
<section id="show">
<h3>Show<a class="headerlink" href="#show" title="Link to this heading"></a></h3>
<div class="cmd cmd-op">
<div class="opcmd-heading">
<span class="opcmd" id="opcmd-show-bgp-ipv4-ipv6">
show bgp &lt;ipv4|ipv6&gt;</span>
<a class="cmdlink" href="#opcmd-show-bgp-ipv4-ipv6" title="Permalink to this Command"></a></div><div class="opcmd-body">
<p>This command displays all entries in BGP routing table.</p>
</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>BGP table version is 10, local router ID is 10.0.35.3, vrf id 0
Default local pref 100, local AS 65000
Status codes:  s suppressed, d damped, h history, * valid, &gt; best, = multipath,
               i internal, r RIB-failure, S Stale, R Removed
Nexthop codes: @NNN nexthop&#39;s vrf id, &lt; announce-nh-self
Origin codes:  i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found

   Network          Next Hop            Metric LocPrf Weight Path
*&gt; 198.51.100.0/24  10.0.34.4                0             0 65004 i
*&gt; 203.0.113.0/24   10.0.35.5                0             0 65005 i

Displayed  2 routes and 2 total paths
</pre></div>
</div>
<div class="cmd cmd-op">
<div class="opcmd-heading">
<span class="opcmd" id="opcmd-show-bgp-ipv4-ipv6-address-prefix">
show bgp &lt;ipv4|ipv6&gt; &lt;address|prefix&gt;</span>
<a class="cmdlink" href="#opcmd-show-bgp-ipv4-ipv6-address-prefix" title="Permalink to this Command"></a></div><div class="opcmd-body">
<p>This command displays information about the particular entry in the BGP
routing table.</p>
</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>BGP routing table entry for 198.51.100.0/24
Paths: (1 available, best #1, table default)
  Advertised to non peer-group peers:
  10.0.13.1 10.0.23.2 10.0.34.4 10.0.35.5
  65004
    10.0.34.4 from 10.0.34.4 (10.0.34.4)
      Origin IGP, metric 0, valid, external, best (First path received)
      Last update: Wed Jan  6 12:18:53 2021
</pre></div>
</div>
<div class="cmd cmd-op">
<div class="opcmd-heading">
<span class="opcmd" id="opcmd-show-ip-bgp-cidr-only">
show ip bgp cidr-only</span>
<a class="cmdlink" href="#opcmd-show-ip-bgp-cidr-only" title="Permalink to this Command"></a></div><div class="opcmd-body">
<p>This command displays routes with classless interdomain routing (CIDR).</p>
</div>
</div>
<div class="cmd cmd-op">
<div class="opcmd-heading">
<span class="opcmd" id="opcmd-show-bgp-ipv4-ipv6-community-value">
show bgp &lt;ipv4|ipv6&gt; community &lt;value&gt;</span>
<a class="cmdlink" href="#opcmd-show-bgp-ipv4-ipv6-community-value" title="Permalink to this Command"></a></div><div class="opcmd-body">
<p>This command displays routes that belong to specified BGP communities.
Valid value is a community number in the range from 1 to 4294967200,
or AA:NN (autonomous system-community number/2-byte number), no-export,
local-as, or no-advertise.</p>
</div>
</div>
<div class="cmd cmd-op">
<div class="opcmd-heading">
<span class="opcmd" id="opcmd-show-bgp-ipv4-ipv6-community-list-name">
show bgp &lt;ipv4|ipv6&gt; community-list &lt;name&gt;</span>
<a class="cmdlink" href="#opcmd-show-bgp-ipv4-ipv6-community-list-name" title="Permalink to this Command"></a></div><div class="opcmd-body">
<p>This command displays routes that are permitted by the BGP
community list.</p>
</div>
</div>
<div class="cmd cmd-op">
<div class="opcmd-heading">
<span class="opcmd" id="opcmd-show-bgp-ipv4-ipv6-dampening-dampened-paths">
show bgp &lt;ipv4|ipv6&gt; dampening dampened-paths</span>
<a class="cmdlink" href="#opcmd-show-bgp-ipv4-ipv6-dampening-dampened-paths" title="Permalink to this Command"></a></div><div class="opcmd-body">
<p>This command displays BGP dampened routes.</p>
</div>
</div>
<div class="cmd cmd-op">
<div class="opcmd-heading">
<span class="opcmd" id="opcmd-show-bgp-ipv4-ipv6-dampening-flap-statistics">
show bgp &lt;ipv4|ipv6&gt; dampening flap-statistics</span>
<a class="cmdlink" href="#opcmd-show-bgp-ipv4-ipv6-dampening-flap-statistics" title="Permalink to this Command"></a></div><div class="opcmd-body">
<p>This command displays information about flapping BGP routes.</p>
</div>
</div>
<div class="cmd cmd-op">
<div class="opcmd-heading">
<span class="opcmd" id="opcmd-show-bgp-ipv4-ipv6-filter-list-name">
show bgp &lt;ipv4|ipv6&gt; filter-list &lt;name&gt;</span>
<a class="cmdlink" href="#opcmd-show-bgp-ipv4-ipv6-filter-list-name" title="Permalink to this Command"></a></div><div class="opcmd-body">
<p>This command displays BGP routes allowed by the specified AS Path
access list.</p>
</div>
</div>
<div class="cmd cmd-op">
<div class="opcmd-heading">
<span class="opcmd" id="opcmd-show-bgp-ipv4-ipv6-neighbors-address-advertised-routes">
show bgp &lt;ipv4|ipv6&gt; neighbors &lt;address&gt; advertised-routes</span>
<a class="cmdlink" href="#opcmd-show-bgp-ipv4-ipv6-neighbors-address-advertised-routes" title="Permalink to this Command"></a></div><div class="opcmd-body">
<p>This command displays BGP routes advertised to a neighbor.</p>
</div>
</div>
<div class="cmd cmd-op">
<div class="opcmd-heading">
<span class="opcmd" id="opcmd-show-bgp-ipv4-ipv6-neighbors-address-received-routes">
show bgp &lt;ipv4|ipv6&gt; neighbors &lt;address&gt; received-routes</span>
<a class="cmdlink" href="#opcmd-show-bgp-ipv4-ipv6-neighbors-address-received-routes" title="Permalink to this Command"></a></div><div class="opcmd-body">
<p>This command displays BGP routes originating from the specified BGP
neighbor before inbound policy is applied. To use this command inbound
soft reconfiguration must be enabled.</p>
</div>
</div>
<div class="cmd cmd-op">
<div class="opcmd-heading">
<span class="opcmd" id="opcmd-show-bgp-ipv4-ipv6-neighbors-address-routes">
show bgp &lt;ipv4|ipv6&gt; neighbors &lt;address&gt; routes</span>
<a class="cmdlink" href="#opcmd-show-bgp-ipv4-ipv6-neighbors-address-routes" title="Permalink to this Command"></a></div><div class="opcmd-body">
<p>This command displays BGP received-routes that are accepted after filtering.</p>
</div>
</div>
<div class="cmd cmd-op">
<div class="opcmd-heading">
<span class="opcmd" id="opcmd-show-bgp-ipv4-ipv6-neighbors-address-dampened-routes">
show bgp &lt;ipv4|ipv6&gt; neighbors &lt;address&gt; dampened-routes</span>
<a class="cmdlink" href="#opcmd-show-bgp-ipv4-ipv6-neighbors-address-dampened-routes" title="Permalink to this Command"></a></div><div class="opcmd-body">
<p>This command displays dampened routes received from BGP neighbor.</p>
</div>
</div>
<div class="cmd cmd-op">
<div class="opcmd-heading">
<span class="opcmd" id="opcmd-show-bgp-ipv4-ipv6-regexp-text">
show bgp &lt;ipv4|ipv6&gt; regexp &lt;text&gt;</span>
<a class="cmdlink" href="#opcmd-show-bgp-ipv4-ipv6-regexp-text" title="Permalink to this Command"></a></div><div class="opcmd-body">
<p>This command displays information about BGP routes whose AS path
matches the specified regular expression.</p>
</div>
</div>
<div class="cmd cmd-op">
<div class="opcmd-heading">
<span class="opcmd" id="opcmd-show-bgp-ipv4-ipv6-summary">
show bgp &lt;ipv4|ipv6&gt; summary</span>
<a class="cmdlink" href="#opcmd-show-bgp-ipv4-ipv6-summary" title="Permalink to this Command"></a></div><div class="opcmd-body">
<p>This command displays the status of all BGP connections.</p>
</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>IPv4 Unicast Summary:
BGP router identifier 10.0.35.3, local AS number 65000 vrf-id 0
BGP table version 11
RIB entries 5, using 920 bytes of memory
Peers 4, using 82 KiB of memory

Neighbor        V         AS MsgRcvd MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd
10.0.13.1       4      65000     148     159        0    0    0 02:16:01            0
10.0.23.2       4      65000     136     143        0    0    0 02:13:21            0
10.0.34.4       4      65004     161     163        0    0    0 02:16:01            1
10.0.35.5       4      65005     162     166        0    0    0 02:16:01            1

Total number of neighbors 4
</pre></div>
</div>
</section>
<section id="reset">
<h3>Reset<a class="headerlink" href="#reset" title="Link to this heading"></a></h3>
<div class="cmd cmd-op">
<div class="opcmd-heading">
<span class="opcmd" id="opcmd-reset-ip-ipv6-bgp-address-soft-in-out">
reset &lt;ip|ipv6&gt; bgp &lt;address&gt; [soft [in|out]]</span>
<a class="cmdlink" href="#opcmd-reset-ip-ipv6-bgp-address-soft-in-out" title="Permalink to this Command"></a></div><div class="opcmd-body">
<p>This command resets BGP connections to the specified neighbor IP address.
With argument <code class="docutils literal notranslate"><span class="pre">soft</span></code> this command initiates a soft reset. If
you do not specify the <code class="docutils literal notranslate"><span class="pre">in</span></code> or <code class="docutils literal notranslate"><span class="pre">out</span></code> options, both
inbound and outbound soft reconfiguration are triggered.</p>
</div>
</div>
<div class="cmd cmd-op">
<div class="opcmd-heading">
<span class="opcmd" id="opcmd-reset-ip-bgp-all">
reset ip bgp all</span>
<a class="cmdlink" href="#opcmd-reset-ip-bgp-all" title="Permalink to this Command"></a></div><div class="opcmd-body">
<p>This command resets all BGP connections of given router.</p>
</div>
</div>
<div class="cmd cmd-op">
<div class="opcmd-heading">
<span class="opcmd" id="opcmd-reset-ip-bgp-dampening">
reset ip bgp dampening</span>
<a class="cmdlink" href="#opcmd-reset-ip-bgp-dampening" title="Permalink to this Command"></a></div><div class="opcmd-body">
<p>This command uses to clear BGP route dampening information and to
unsuppress suppressed routes.</p>
</div>
</div>
<div class="cmd cmd-op">
<div class="opcmd-heading">
<span class="opcmd" id="opcmd-reset-ip-bgp-external">
reset ip bgp external</span>
<a class="cmdlink" href="#opcmd-reset-ip-bgp-external" title="Permalink to this Command"></a></div><div class="opcmd-body">
<p>This command resets all external BGP peers of given router.</p>
</div>
</div>
<div class="cmd cmd-op">
<div class="opcmd-heading">
<span class="opcmd" id="opcmd-reset-ip-bgp-peer-group-name-soft-in-out">
reset ip bgp peer-group &lt;name&gt; [soft [in|out]]</span>
<a class="cmdlink" href="#opcmd-reset-ip-bgp-peer-group-name-soft-in-out" title="Permalink to this Command"></a></div><div class="opcmd-body">
<p>This command resets BGP connections to the specified peer group.
With argument <code class="docutils literal notranslate"><span class="pre">soft</span></code> this command initiates a soft reset. If
you do not specify the <code class="docutils literal notranslate"><span class="pre">in</span></code> or <code class="docutils literal notranslate"><span class="pre">out</span></code> options, both
inbound and outbound soft reconfiguration are triggered.</p>
</div>
</div>
</section>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Link to this heading"></a></h2>
<section id="ipv4-peering">
<h3>IPv4 peering<a class="headerlink" href="#ipv4-peering" title="Link to this heading"></a></h3>
<p>A simple eBGP configuration:</p>
<p><strong>Node 1:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set protocols bgp system-as 65534
set protocols bgp neighbor 192.168.0.2 ebgp-multihop &#39;2&#39;
set protocols bgp neighbor 192.168.0.2 remote-as &#39;65535&#39;
set protocols bgp neighbor 192.168.0.2 update-source &#39;192.168.0.1&#39;
set protocols bgp address-family ipv4-unicast network &#39;172.16.0.0/16&#39;
set protocols bgp parameters router-id &#39;192.168.0.1&#39;
</pre></div>
</div>
<p><strong>Node 2:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set protocols bgp system-as 65535
set protocols bgp neighbor 192.168.0.1 ebgp-multihop &#39;2&#39;
set protocols bgp neighbor 192.168.0.1 remote-as &#39;65534&#39;
set protocols bgp neighbor 192.168.0.1 update-source &#39;192.168.0.2&#39;
set protocols bgp address-family ipv4-unicast network &#39;172.17.0.0/16&#39;
set protocols bgp parameters router-id &#39;192.168.0.2&#39;
</pre></div>
</div>
<p>Don’t forget, the CIDR declared in the network statement MUST <strong>exist in your
routing table (dynamic or static), the best way to make sure that is true is
creating a static route:</strong></p>
<p><strong>Node 1:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set protocols static route 172.16.0.0/16 blackhole distance &#39;254&#39;
</pre></div>
</div>
<p><strong>Node 2:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set protocols static route 172.17.0.0/16 blackhole distance &#39;254&#39;
</pre></div>
</div>
</section>
<section id="ipv6-peering">
<h3>IPv6 peering<a class="headerlink" href="#ipv6-peering" title="Link to this heading"></a></h3>
<p>A simple BGP configuration via IPv6.</p>
<p><strong>Node 1:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set protocols bgp system-as 65534
set protocols bgp neighbor 2001:db8::2 ebgp-multihop &#39;2&#39;
set protocols bgp neighbor 2001:db8::2 remote-as &#39;65535&#39;
set protocols bgp neighbor 2001:db8::2 update-source &#39;2001:db8::1&#39;
set protocols bgp neighbor 2001:db8::2 address-family ipv6-unicast
set protocols bgp address-family ipv6-unicast network &#39;2001:db8:1::/48&#39;
set protocols bgp parameters router-id &#39;10.1.1.1&#39;
</pre></div>
</div>
<p><strong>Node 2:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set protocols bgp system-as 65535
set protocols bgp neighbor 2001:db8::1 ebgp-multihop &#39;2&#39;
set protocols bgp neighbor 2001:db8::1 remote-as &#39;65534&#39;
set protocols bgp neighbor 2001:db8::1 update-source &#39;2001:db8::2&#39;
set protocols bgp neighbor 2001:db8::1 address-family ipv6-unicast
set protocols bgp address-family ipv6-unicast network &#39;2001:db8:2::/48&#39;
set protocols bgp parameters router-id &#39;10.1.1.2&#39;
</pre></div>
</div>
<p>Don’t forget, the CIDR declared in the network statement <strong>MUST exist in your
routing table (dynamic or static), the best way to make sure that is true is
creating a static route:</strong></p>
<p><strong>Node 1:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set protocols static route6 2001:db8:1::/48 blackhole distance &#39;254&#39;
</pre></div>
</div>
<p><strong>Node 2:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set protocols static route6 2001:db8:2::/48 blackhole distance &#39;254&#39;
</pre></div>
</div>
</section>
<section id="route-filtering">
<h3>Route Filtering<a class="headerlink" href="#route-filtering" title="Link to this heading"></a></h3>
<p>Route filter can be applied using a route-map:</p>
<p><strong>Node1:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set policy prefix-list AS65535-IN rule 10 action &#39;permit&#39;
set policy prefix-list AS65535-IN rule 10 prefix &#39;172.16.0.0/16&#39;
set policy prefix-list AS65535-OUT rule 10 action &#39;deny&#39;
set policy prefix-list AS65535-OUT rule 10 prefix &#39;172.16.0.0/16&#39;
set policy prefix-list6 AS65535-IN rule 10 action &#39;permit&#39;
set policy prefix-list6 AS65535-IN rule 10 prefix &#39;2001:db8:2::/48&#39;
set policy prefix-list6 AS65535-OUT rule 10 action &#39;deny&#39;
set policy prefix-list6 AS65535-OUT rule 10 prefix &#39;2001:db8:2::/48&#39;

set policy route-map AS65535-IN rule 10 action &#39;permit&#39;
set policy route-map AS65535-IN rule 10 match ip address prefix-list &#39;AS65535-IN&#39;
set policy route-map AS65535-IN rule 10 match ipv6 address prefix-list &#39;AS65535-IN&#39;
set policy route-map AS65535-IN rule 20 action &#39;deny&#39;
set policy route-map AS65535-OUT rule 10 action &#39;deny&#39;
set policy route-map AS65535-OUT rule 10 match ip address prefix-list &#39;AS65535-OUT&#39;
set policy route-map AS65535-OUT rule 10 match ipv6 address prefix-list &#39;AS65535-OUT&#39;
set policy route-map AS65535-OUT rule 20 action &#39;permit&#39;

set protocols bgp system-as 65534
set protocols bgp neighbor 2001:db8::2 address-family ipv4-unicast route-map export &#39;AS65535-OUT&#39;
set protocols bgp neighbor 2001:db8::2 address-family ipv4-unicast route-map import &#39;AS65535-IN&#39;
set protocols bgp neighbor 2001:db8::2 address-family ipv6-unicast route-map export &#39;AS65535-OUT&#39;
set protocols bgp neighbor 2001:db8::2 address-family ipv6-unicast route-map import &#39;AS65535-IN&#39;
</pre></div>
</div>
<p><strong>Node2:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set policy prefix-list AS65534-IN rule 10 action &#39;permit&#39;
set policy prefix-list AS65534-IN rule 10 prefix &#39;172.17.0.0/16&#39;
set policy prefix-list AS65534-OUT rule 10 action &#39;deny&#39;
set policy prefix-list AS65534-OUT rule 10 prefix &#39;172.17.0.0/16&#39;
set policy prefix-list6 AS65534-IN rule 10 action &#39;permit&#39;
set policy prefix-list6 AS65534-IN rule 10 prefix &#39;2001:db8:1::/48&#39;
set policy prefix-list6 AS65534-OUT rule 10 action &#39;deny&#39;
set policy prefix-list6 AS65534-OUT rule 10 prefix &#39;2001:db8:1::/48&#39;

set policy route-map AS65534-IN rule 10 action &#39;permit&#39;
set policy route-map AS65534-IN rule 10 match ip address prefix-list &#39;AS65534-IN&#39;
set policy route-map AS65534-IN rule 10 match ipv6 address prefix-list &#39;AS65534-IN&#39;
set policy route-map AS65534-IN rule 20 action &#39;deny&#39;
set policy route-map AS65534-OUT rule 10 action &#39;deny&#39;
set policy route-map AS65534-OUT rule 10 match ip address prefix-list &#39;AS65534-OUT&#39;
set policy route-map AS65534-OUT rule 10 match ipv6 address prefix-list &#39;AS65534-OUT&#39;
set policy route-map AS65534-OUT rule 20 action &#39;permit&#39;

set protocols bgp system-as 65535
set protocols bgp neighbor 2001:db8::1 address-family ipv4-unicast route-map export &#39;AS65534-OUT&#39;
set protocols bgp neighbor 2001:db8::1 address-family ipv4-unicast route-map import &#39;AS65534-IN&#39;
set protocols bgp neighbor 2001:db8::1 address-family ipv6-unicast route-map export &#39;AS65534-OUT&#39;
set protocols bgp neighbor 2001:db8::1 address-family ipv6-unicast route-map import &#39;AS65534-IN&#39;
</pre></div>
</div>
<p>We could expand on this and also deny link local and multicast in the rule 20
action deny.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="bfd.html" class="btn btn-neutral float-left" title="BFD" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="failover.html" class="btn btn-neutral float-right" title="Failover" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../copyright.html">Copyright</a> 2024, VyOS maintainers and contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <head>
      <style>
          #branch-select-container {
              position: fixed;
              bottom: 10px;
              right: 10px;
              background-color: #f0f0f0;
              padding: 5px;
              border: 1px solid #ccc;
              border-radius: 5px;
          }
      </style>
  </head>
  <body>
      <div id="branch-select-container">
          <select id="branch-select">
              <option value="sagitta">Sagitta</option>
              <option value="circinus">Circinus</option>
          </select>
      </div>
      <script>
          // Define the branches
          const branches = ['sagitta', 'circinus'];
  
          // Get the current branch name from the URL
          const currentUrl = window.location.href;
          const currentBranch = branches.find(branch => currentUrl.includes(branch));
  
          // Set the selected option in the dropdown
          const branchSelect = document.getElementById('branch-select');
          branchSelect.value = currentBranch;
  
          // Add an event listener to the dropdown
          branchSelect.addEventListener('change', () => {
              const newBranch = branchSelect.value;
              const newUrl = currentUrl.replace(currentBranch, newBranch);
              window.location.href = newUrl;
          });
      </script>
  </body>


</body>
</html>