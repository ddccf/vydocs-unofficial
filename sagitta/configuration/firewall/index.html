

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Firewall &mdash; VyOS 1.4.x (sagitta) documentation</title>
      <link rel="stylesheet" type="text/css" href="../../static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="../../static/vyos-logo-icon.png"/>
      <script src="../../static/jquery.js?v=5d32c60e"></script>
      <script src="../../static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../static/documentation_options.js?v=8f5ed1cd"></script>
      <script src="../../static/doctools.js?v=9bcbadda"></script>
      <script src="../../static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../static/design-tabs.js?v=f930bc37"></script>
    <script src="../../static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="Global Options Firewall Configuration" href="global-options.html" />
    <link rel="prev" title="Container" href="../container/index.html" />
    <style>#vyos-header-iframe{position:fixed;top:0;left:0;right:0;z-index:999999999;width:100%;border:none}</style>
    <style>#vyos-footer-iframe{width:100%;border:none}</style>
    <link href="../../static/css/custom.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/lists.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/hints.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/headers.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/breadcrumbs.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/linkButtons.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/text.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/leftSidebar.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/scrolls.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/tables.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/installation/running-on-bare-metal.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/code-snippets.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/separate-commands.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/configuration/index.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/datatables.css" rel="stylesheet" type="text/css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script type="text/javascript" charset="utf8" src="../../static/js/datatables.js"></script>
    <script type="text/javascript" charset="utf8" src="../../static/js/tables.js"></script>
    <script type="text/javascript" charset="utf8" src="../../static/js/codecopier.js"></script>
    <script type="text/javascript" charset="utf8" src="../../static/js/sidebar.js"></script>
    <script type="text/javascript" charset="utf8" src="../../static/js/footer.js"></script>
    </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            VyOS
              <img src="../../static/vyos-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../introducing/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introducing/history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog/index.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">First Steps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation and Image Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quick-start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli.html#configuration-overview">Configuration Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Adminguide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Configuration Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../container/index.html">Container</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Firewall</a><ul>
<li class="toctree-l3"><a class="reference internal" href="global-options.html">Global Options Firewall Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="groups.html">Firewall groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="bridge.html">Bridge Firewall Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="ipv4.html">IPv4 Firewall Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="ipv6.html">IPv6 Firewall Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="flowtables.html">Flowtables Firewall Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zone-based-firewall">Zone-based firewall</a><ul>
<li class="toctree-l4"><a class="reference internal" href="zone.html">Zone Based Firewall</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../highavailability/index.html">High availability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interfaces/index.html">Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../loadbalancing/index.html">Load-balancing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nat/index.html">NAT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../policy/index.html">Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pki/index.html">PKI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/index.html">Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../service/index.html">Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../system/index.html">System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../trafficpolicy/index.html">Traffic Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vpn/index.html">VPN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vrf/index.html">VRF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vrf/index.html#l3vpn-vrfs">L3VPN VRFs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../operation/index.html">Operation Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../automation/index.html">VyOS Automation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configexamples/index.html">Configuration Blueprints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configexamples/index.html#configuration-blueprints-autotest">Configuration Blueprints (autotest)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/build-vyos.html">Build VyOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/issues-features.html">Issues/Feature requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/upstream-packages.html">Upstream packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/testing.html">Testing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">Write Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../coverage.html">Coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../copyright.html">Copyright Notice</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">VyOS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Configuration Guide</a></li>
      <li class="breadcrumb-item active">Firewall</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../sources/configuration/firewall/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="firewall">
<h1>Firewall<a class="headerlink" href="#firewall" title="Link to this heading"></a></h1>
<p>As VyOS is based on Linux it leverages its firewall. The Netfilter project
created iptables and its successor nftables for the Linux kernel to
work directly on packet data flows. This now extends the concept of
zone-based security to allow for manipulating the data at multiple stages once
accepted by the network interface and the driver before being handed off to
the destination (e.g., a web server OR another device).</p>
<p>A simplified traffic flow diagram, based on Netfilter packet flow, is shown
next, in order to have a full view and understanding of how packets are
processed, and what possible paths traffic can take.</p>
<figure class="align-default">
<img alt="../../images/firewall-gral-packet-flow.png" src="../../images/firewall-gral-packet-flow.png" />
</figure>
<p>The main points regarding this packet flow and terminology used in VyOS
firewall are covered below:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Bridge Port?</strong>: choose appropriate path based on whether interface
where the packet was received is part of a bridge, or not.</p></li>
</ul>
</div></blockquote>
<p>If the interface where the packet was received isn’t part of a bridge, then
packetis processed at the <strong>IP Layer</strong>:</p>
<blockquote>
<div><ul>
<li><p><strong>Prerouting</strong>: several actions can be done in this stage, and currently
these actions are defined in different parts in VyOS configuration. Order
is important, and all these actions are performed before any actions
defined under <code class="docutils literal notranslate"><span class="pre">firewall</span></code> section. Relevant configuration that acts in
this stage are:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Conntrack Ignore</strong>: rules defined under <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">system</span> <span class="pre">conntrack</span> <span class="pre">ignore</span>
<span class="pre">[ipv4</span> <span class="pre">|</span> <span class="pre">ipv6]</span> <span class="pre">...</span></code>.</p></li>
<li><p><strong>Policy Route</strong>: rules defined under <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">policy</span> <span class="pre">[route</span> <span class="pre">|</span> <span class="pre">route6]</span>
<span class="pre">...</span></code>.</p></li>
<li><p><strong>Destination NAT</strong>: rules defined under <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">[nat</span> <span class="pre">|</span> <span class="pre">nat66]</span>
<span class="pre">destination...</span></code>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Destination is the router?</strong>: choose appropriate path based on
destination IP address. Transit forward continues to <strong>forward</strong>,
while traffic that destination IP address is configured on the router
continues to <strong>input</strong>.</p></li>
<li><p><strong>Input</strong>: stage where traffic destined for the router itself can be
filtered and controlled. This is where all rules for securing the router
should take place. This includes ipv4 and ipv6 filtering rules, defined
in:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">firewall</span> <span class="pre">ipv4</span> <span class="pre">input</span> <span class="pre">filter</span> <span class="pre">...</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">firewall</span> <span class="pre">ipv6</span> <span class="pre">input</span> <span class="pre">filter</span> <span class="pre">...</span></code>.</p></li>
</ul>
</li>
<li><p><strong>Forward</strong>: stage where transit traffic can be filtered and controlled.
This includes ipv4 and ipv6 filtering rules, defined in:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">firewall</span> <span class="pre">ipv4</span> <span class="pre">forward</span> <span class="pre">filter</span> <span class="pre">...</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">firewall</span> <span class="pre">ipv6</span> <span class="pre">forward</span> <span class="pre">filter</span> <span class="pre">...</span></code>.</p></li>
</ul>
</li>
<li><p><strong>Output</strong>: stage where traffic that originates from the router itself
can be filtered and controlled. Bear in mind that this traffic can be a
new connection originated by a internal process running on VyOS router,
such as NTP, or a response to traffic received externaly through
<strong>input</strong> (for example response to an ssh login attempt to the router).
This includes ipv4 and ipv6 filtering rules, defined in:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">firewall</span> <span class="pre">ipv4</span> <span class="pre">output</span> <span class="pre">filter</span> <span class="pre">...</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">firewall</span> <span class="pre">ipv6</span> <span class="pre">output</span> <span class="pre">filter</span> <span class="pre">...</span></code>.</p></li>
</ul>
</li>
<li><p><strong>Postrouting</strong>: as in <strong>Prerouting</strong>, several actions defined in
different parts of VyOS configuration are performed in this
stage. This includes:</p>
<ul class="simple">
<li><p><strong>Source NAT</strong>: rules defined under <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">[nat</span> <span class="pre">|</span> <span class="pre">nat66]</span>
<span class="pre">destination...</span></code>.</p></li>
</ul>
</li>
</ul>
</div></blockquote>
<p>If the interface where the packet was received is part of a bridge, then
the packet is processed at the <strong>Bridge Layer</strong>, which contains a basic setup for
bridge filtering:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Forward (Bridge)</strong>: stage where traffic that is trespasing through the
bridge is filtered and controlled:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">firewall</span> <span class="pre">bridge</span> <span class="pre">forward</span> <span class="pre">filter</span> <span class="pre">...</span></code>.</p></li>
</ul>
</li>
</ul>
</div></blockquote>
<p>The main structure of the VyOS firewall CLI is shown next:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>- set firewall
    * bridge
         - forward
            + filter
    * flowtable
         - custom_flow_table
            + ...
    * global-options
         + all-ping
         + broadcast-ping
         + ...
    * group
         - address-group
         - ipv6-address-group
         - network-group
         - ipv6-network-group
         - interface-group
         - mac-group
         - port-group
         - domain-group
    * ipv4
         - forward
            + filter
         - input
            + filter
         - output
            + filter
         - name
            + custom_name
    * ipv6
         - forward
            + filter
         - input
            + filter
         - output
            + filter
         - ipv6-name
            + custom_name
    * zone
         - custom_zone_name
            + ...
</pre></div>
</div>
<p>Please, refer to appropriate section for more information about firewall
configuration:</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="global-options.html">Global Options Firewall Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="groups.html">Firewall groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="bridge.html">Bridge Firewall Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipv4.html">IPv4 Firewall Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipv6.html">IPv6 Firewall Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="flowtables.html">Flowtables Firewall Configuration</a></li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>For more information</strong>
of Netfilter hooks and Linux networking packet flows can be
found in <a class="reference external" href="https://wiki.nftables.org/wiki-nftables/index.php/Netfilter_hooks">Netfilter-Hooks</a></p>
</div>
<section id="zone-based-firewall">
<h2>Zone-based firewall<a class="headerlink" href="#zone-based-firewall" title="Link to this heading"></a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="zone.html">Zone Based Firewall</a></li>
</ul>
</div>
<p>With zone-based firewalls a new concept was implemented, in addition to the
standard in and out traffic flows, a local flow was added. This local was for
traffic originating and destined to the router itself. Which means additional
rules were required to secure the firewall itself from the network, in
addition to the existing inbound and outbound rules from the traditional
concept above.</p>
<p>To configure VyOS with the
<a class="reference internal" href="zone.html"><span class="doc">zone-based firewall configuration</span></a></p>
<p>As the example image below shows, the device now needs rules to allow/block
traffic to or from the services running on the device that have open
connections on that interface.</p>
<figure class="align-default">
<img alt="../../images/firewall-zonebased.png" src="../../images/firewall-zonebased.png" />
</figure>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../container/index.html" class="btn btn-neutral float-left" title="Container" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="global-options.html" class="btn btn-neutral float-right" title="Global Options Firewall Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../copyright.html">Copyright</a> 2023, VyOS maintainers and contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>