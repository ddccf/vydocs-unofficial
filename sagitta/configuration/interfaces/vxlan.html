

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VXLAN &mdash; VyOS 1.4.x (sagitta) documentation</title>
      <link rel="stylesheet" type="text/css" href="../../static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="../../static/vyos-logo-icon.png"/>
      <script src="../../static/jquery.js?v=5d32c60e"></script>
      <script src="../../static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../static/documentation_options.js?v=8f5ed1cd"></script>
      <script src="../../static/doctools.js?v=9bcbadda"></script>
      <script src="../../static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../static/design-tabs.js?v=f930bc37"></script>
    <script src="../../static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="WLAN/WIFI - Wireless LAN" href="wireless.html" />
    <link rel="prev" title="VTI - Virtual Tunnel Interface" href="vti.html" />
    <style>#vyos-header-iframe{position:fixed;top:0;left:0;right:0;z-index:999999999;width:100%;border:none}</style>
    <style>#vyos-footer-iframe{width:100%;border:none}</style>
    <link href="../../static/css/custom.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/lists.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/hints.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/headers.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/breadcrumbs.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/linkButtons.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/text.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/leftSidebar.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/scrolls.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/tables.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/installation/running-on-bare-metal.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/code-snippets.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/separate-commands.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/configuration/index.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/datatables.css" rel="stylesheet" type="text/css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script type="text/javascript" charset="utf8" src="../../static/js/datatables.js"></script>
    <script type="text/javascript" charset="utf8" src="../../static/js/tables.js"></script>
    <script type="text/javascript" charset="utf8" src="../../static/js/codecopier.js"></script>
    <script type="text/javascript" charset="utf8" src="../../static/js/sidebar.js"></script>
    <script type="text/javascript" charset="utf8" src="../../static/js/footer.js"></script>
    </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            VyOS
              <img src="../../static/vyos-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../introducing/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introducing/history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog/index.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">First Steps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation and Image Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quick-start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli.html#configuration-overview">Configuration Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Adminguide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Configuration Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../container/index.html">Container</a></li>
<li class="toctree-l2"><a class="reference internal" href="../firewall/index.html">Firewall</a></li>
<li class="toctree-l2"><a class="reference internal" href="../highavailability/index.html">High availability</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Interfaces</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="bonding.html">Bond / Link Aggregation</a></li>
<li class="toctree-l3"><a class="reference internal" href="bridge.html">Bridge</a></li>
<li class="toctree-l3"><a class="reference internal" href="dummy.html">Dummy</a></li>
<li class="toctree-l3"><a class="reference internal" href="ethernet.html">Ethernet</a></li>
<li class="toctree-l3"><a class="reference internal" href="geneve.html">GENEVE</a></li>
<li class="toctree-l3"><a class="reference internal" href="l2tpv3.html">L2TPv3</a></li>
<li class="toctree-l3"><a class="reference internal" href="loopback.html">Loopback</a></li>
<li class="toctree-l3"><a class="reference internal" href="macsec.html">MACsec</a></li>
<li class="toctree-l3"><a class="reference internal" href="openvpn.html">OpenVPN</a></li>
<li class="toctree-l3"><a class="reference internal" href="wireguard.html">WireGuard</a></li>
<li class="toctree-l3"><a class="reference internal" href="pppoe.html">PPPoE</a></li>
<li class="toctree-l3"><a class="reference internal" href="pseudo-ethernet.html">MACVLAN - Pseudo Ethernet</a></li>
<li class="toctree-l3"><a class="reference internal" href="sstp-client.html">SSTP Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="tunnel.html">Tunnel</a></li>
<li class="toctree-l3"><a class="reference internal" href="virtual-ethernet.html">Virtual Ethernet</a></li>
<li class="toctree-l3"><a class="reference internal" href="vti.html">VTI - Virtual Tunnel Interface</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">VXLAN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multicast-vxlan">Multicast VXLAN</a></li>
<li class="toctree-l4"><a class="reference internal" href="#single-vxlan-device-svd">Single VXLAN device (SVD)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#unicast-vxlan">Unicast VXLAN</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="wireless.html">WLAN/WIFI - Wireless LAN</a></li>
<li class="toctree-l3"><a class="reference internal" href="wwan.html">WWAN - Wireless Wide-Area-Network</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../loadbalancing/index.html">Load-balancing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nat/index.html">NAT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../policy/index.html">Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pki/index.html">PKI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/index.html">Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../service/index.html">Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../system/index.html">System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../trafficpolicy/index.html">Traffic Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vpn/index.html">VPN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vrf/index.html">VRF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vrf/index.html#l3vpn-vrfs">L3VPN VRFs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../operation/index.html">Operation Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../automation/index.html">VyOS Automation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configexamples/index.html">Configuration Blueprints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configexamples/index.html#configuration-blueprints-autotest">Configuration Blueprints (autotest)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/build-vyos.html">Build VyOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/issues-features.html">Issues/Feature requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/upstream-packages.html">Upstream packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/testing.html">Testing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">Write Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../coverage.html">Coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../copyright.html">Copyright Notice</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">VyOS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Configuration Guide</a></li>
          <li class="breadcrumb-item"><a href="index.html">Interfaces</a></li>
      <li class="breadcrumb-item active">VXLAN</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../sources/configuration/interfaces/vxlan.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="vxlan">
<span id="vxlan-interface"></span><h1>VXLAN<a class="headerlink" href="#vxlan" title="Link to this heading"></a></h1>
<p><abbr title="Virtual Extensible LAN">VXLAN</abbr> is a network virtualization technology
that attempts to address the scalability problems associated with large cloud
computing deployments. It uses a VLAN-like encapsulation technique to
encapsulate OSI layer 2 Ethernet frames within layer 4 UDP datagrams, using
4789 as the default IANA-assigned destination UDP port number. VXLAN
endpoints, which terminate VXLAN tunnels and may be either virtual or physical
switch ports, are known as <abbr title="VXLAN tunnel endpoints">VTEPs</abbr>.</p>
<p>VXLAN is an evolution of efforts to standardize an overlay encapsulation
protocol. It increases the scalability up to 16 million logical networks and
allows for layer 2 adjacency across IP networks. Multicast or unicast with
head-end replication (HER) is used to flood broadcast, unknown unicast,
and multicast (BUM) traffic.</p>
<p>The VXLAN specification was originally created by VMware, Arista Networks
and Cisco. Other backers of the VXLAN technology include Huawei, Broadcom,
Citrix, Pica8, Big Switch Networks, Cumulus Networks, Dell EMC, Ericsson,
Mellanox, FreeBSD, OpenBSD, Red Hat, Joyent, and Juniper Networks.</p>
<p>VXLAN was officially documented by the IETF in <span class="target" id="index-0"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7348.html"><strong>RFC 7348</strong></a>.</p>
<p>If configuring VXLAN in a VyOS virtual machine, ensure that MAC spoofing
(Hyper-V) or Forged Transmits (ESX) are permitted, otherwise forwarded frames
may be blocked by the hypervisor.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As VyOS is based on Linux and there was no official IANA port assigned
for VXLAN, VyOS uses a default port of 8472. You can change the port on a
per VXLAN interface basis to get it working across multiple vendors.</p>
</div>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h2>
<section id="common-interface-configuration">
<h3>Common interface configuration<a class="headerlink" href="#common-interface-configuration" title="Link to this heading"></a></h3>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-address-address">
set interfaces vxlan &lt;interface&gt; address &lt;address&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-address-address" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Configure interface <cite>&lt;interface&gt;</cite> with one or more interface
addresses.</p>
<ul class="simple">
<li><p><strong>address</strong> can be specified multiple times as IPv4 and/or IPv6
address, e.g. 192.0.2.1/24 and/or 2001:db8::1/64</p></li>
</ul>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 address 192.0.2.1/24
set interfaces vxlan vxlan0 address 2001:db8::1/64
</pre></div>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-description-description">
set interfaces vxlan &lt;interface&gt; description &lt;description&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-description-description" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Set a human readable, descriptive alias for this connection. Alias is used by
e.g. the <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">interfaces</span></code> command or SNMP based monitoring tools.</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 description &#39;This is an awesome interface running on VyOS&#39;
</pre></div>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-disable">
set interfaces vxlan &lt;interface&gt; disable</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-disable" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Disable given <cite>&lt;interface&gt;</cite>. It will be placed in administratively down
(<code class="docutils literal notranslate"><span class="pre">A/D</span></code>) state.</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 disable
</pre></div>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-disable-flow-control">
set interfaces vxlan &lt;interface&gt;  disable-flow-control</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-disable-flow-control" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Ethernet flow control is a mechanism for temporarily stopping the transmission
of data on Ethernet family computer networks. The goal of this mechanism is to
ensure zero packet loss in the presence of network congestion.</p>
<p>The first flow control mechanism, the pause frame, was defined by the IEEE
802.3x standard.</p>
<p>A sending station (computer or network switch) may be transmitting data faster
than the other end of the link can accept it. Using flow control, the
receiving station can signal the sender requesting suspension of
transmissions until the receiver catches up.</p>
<p>Use this command to disable the generation of Ethernet flow control (pause
frames).</p>
<blockquote>
<div><p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 disable-flow-control
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-disable-link-detect">
set interfaces vxlan &lt;interface&gt; disable-link-detect</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-disable-link-detect" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Use this command to direct an interface to not detect any physical state
changes on a link, for example, when the cable is unplugged.</p>
<p>Default is to detects physical link state changes.</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 disable-link-detect
</pre></div>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-mac-xx-xx-xx-xx-xx-xx">
set interfaces vxlan &lt;interface&gt; mac &lt;xx:xx:xx:xx:xx:xx&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-mac-xx-xx-xx-xx-xx-xx" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Configure user defined <abbr title="Media Access Control">MAC</abbr> address on given
<cite>&lt;interface&gt;</cite>.</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 mac &#39;00:01:02:03:04:05&#39;
</pre></div>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-mtu-mtu">
set interfaces vxlan &lt;interface&gt; mtu &lt;mtu&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-mtu-mtu" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Configure <abbr title="Maximum Transmission Unit">MTU</abbr> on given <cite>&lt;interface&gt;</cite>. It
is the size (in bytes) of the largest ethernet frame sent on this link.</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 mtu 1600
</pre></div>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-ip-adjust-mss-mss-clamp-mss-to-pmtu">
set interfaces vxlan &lt;interface&gt; ip adjust-mss &lt;mss | clamp-mss-to-pmtu&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-ip-adjust-mss-mss-clamp-mss-to-pmtu" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>As Internet wide PMTU discovery rarely works, we sometimes need to clamp our
TCP MSS value to a specific value. This is a field in the TCP options part of
a SYN packet. By setting the MSS value, you are telling the remote side
unequivocally ‘do not try to send me packets bigger than this value’.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command was introduced in VyOS 1.4 - it was previously called:
<code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">firewall</span> <span class="pre">options</span> <span class="pre">interface</span> <span class="pre">&lt;name&gt;</span> <span class="pre">adjust-mss</span> <span class="pre">&lt;value&gt;</span></code></p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>MSS value = MTU - 20 (IP header) - 20 (TCP header), resulting in
1452 bytes on a 1492 byte MTU.</p>
</div>
<p>Instead of a numerical MSS value <cite>clamp-mss-to-pmtu</cite> can be used to
automatically set the proper value.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-ip-arp-cache-timeout">
set interfaces vxlan &lt;interface&gt; ip arp-cache-timeout</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-ip-arp-cache-timeout" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Once a neighbor has been found, the entry is considered to be valid for at
least for this specific time. An entry’s validity will be extended if it
receives positive feedback from higher level protocols.</p>
<p>This defaults to 30 seconds.</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 ip arp-cache-timeout 180
</pre></div>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-ip-disable-arp-filter">
set interfaces vxlan &lt;interface&gt; ip disable-arp-filter</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-ip-disable-arp-filter" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>If set the kernel can respond to arp requests with addresses from other
interfaces. This may seem wrong but it usually makes sense, because it
increases the chance of successful communication. IP addresses are owned by
the complete host on Linux, not by particular interfaces. Only for more
complex setups like load-balancing, does this behaviour cause problems.</p>
<p>If not set (default) allows you to have multiple network interfaces on the
same subnet, and have the ARPs for each interface be answered based on whether
or not the kernel would route a packet from the ARP’d IP out that interface
(therefore you must use source based routing for this to work).</p>
<p>In other words it allows control of which cards (usually 1) will respond to an
arp request.</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 ip disable-arp-filter
</pre></div>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-ip-disable-forwarding">
set interfaces vxlan &lt;interface&gt; ip disable-forwarding</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-ip-disable-forwarding" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Configure interface-specific Host/Router behaviour. If set, the interface will
switch to host mode and IPv6 forwarding will be disabled on this interface.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 ip disable-forwarding
</pre></div>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-ip-enable-directed-broadcast">
set interfaces vxlan &lt;interface&gt; ip enable-directed-broadcast</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-ip-enable-directed-broadcast" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Define different modes for IP directed broadcast forwarding as described in
<span class="target" id="index-1"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1812.html"><strong>RFC 1812</strong></a> and <span class="target" id="index-2"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2644.html"><strong>RFC 2644</strong></a>.</p>
<p>If configured, incoming IP directed broadcast packets on this interface will
be forwarded.</p>
<p>If this option is unset (default), incoming IP directed broadcast packets
will not be forwarded.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 ip enable-directed-broadcast
</pre></div>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-ip-enable-arp-accept">
set interfaces vxlan &lt;interface&gt; ip enable-arp-accept</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-ip-enable-arp-accept" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Define behavior for gratuitous ARP frames who’s IP is not already present in
the ARP table. If configured create new entries in the ARP table.</p>
<p>Both replies and requests type gratuitous arp will trigger the ARP table to be
updated, if this setting is on.</p>
<p>If the ARP table already contains the IP address of the gratuitous arp frame,
the arp table will be updated regardless if this setting is on or off.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 ip enable-arp-accept
</pre></div>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-ip-enable-arp-announce">
set interfaces vxlan &lt;interface&gt; ip enable-arp-announce</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-ip-enable-arp-announce" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Define different restriction levels for announcing the local source IP address
from IP packets in ARP requests sent on interface.</p>
<p>Use any local address, configured on any interface if this is not set.</p>
<p>If configured, try to avoid local addresses that are not in the target’s
subnet for this interface. This mode is useful when target hosts reachable via
this interface require the source IP address in ARP requests to be part of
their logical network configured on the receiving interface. When we generate
the request we will check all our subnets that include the target IP and will
preserve the source address if it is from such subnet. If there is no such
subnet we select source address according to the rules for level 2.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 ip enable-arp-announce
</pre></div>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-ip-enable-arp-ignore">
set interfaces vxlan &lt;interface&gt; ip enable-arp-ignore</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-ip-enable-arp-ignore" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Define different modes for sending replies in response to received ARP
requests that resolve local target IP addresses:</p>
<p>If configured, reply only if the target IP address is local address configured
on the incoming interface.</p>
<p>If this option is unset (default), reply for any local target IP address,
configured on any interface.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 ip enable-arp-ignore
</pre></div>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-ip-enable-proxy-arp">
set interfaces vxlan &lt;interface&gt; ip enable-proxy-arp</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-ip-enable-proxy-arp" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Use this command to enable proxy Address Resolution Protocol (ARP) on this
interface. Proxy ARP allows an Ethernet interface to respond with its own
<abbr title="Media Access Control">MAC</abbr> address to ARP requests for destination IP
addresses on subnets attached to other interfaces on the system. Subsequent
packets sent to those destination IP addresses are forwarded appropriately by
the system.</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 ip enable-proxy-arp
</pre></div>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-ip-proxy-arp-pvlan">
set interfaces vxlan &lt;interface&gt; ip proxy-arp-pvlan</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-ip-proxy-arp-pvlan" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Private VLAN proxy arp. Basically allow proxy arp replies back to the same
interface (from which the ARP request/solicitation was received).</p>
<p>This is done to support (ethernet) switch features, like <span class="target" id="index-3"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3069.html"><strong>RFC 3069</strong></a>, where
the individual ports are NOT allowed to communicate with each other, but they
are allowed to talk to the upstream router. As described in <span class="target" id="index-4"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3069.html"><strong>RFC 3069</strong></a>, it is
possible to allow these hosts to communicate through the upstream router by
proxy_arp’ing.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Does not need to be used together with proxy_arp.</p>
</div>
<p>This technology is known by different names:</p>
<ul class="simple">
<li><p>In <span class="target" id="index-5"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3069.html"><strong>RFC 3069</strong></a> it is called VLAN Aggregation</p></li>
<li><p>Cisco and Allied Telesyn call it Private VLAN</p></li>
<li><p>Hewlett-Packard call it Source-Port filtering or port-isolation</p></li>
<li><p>Ericsson call it MAC-Forced Forwarding (RFC Draft)</p></li>
</ul>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-ip-source-validation-strict-loose-disable">
set interfaces vxlan &lt;interface&gt; ip source-validation &lt;strict | loose | disable&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-ip-source-validation-strict-loose-disable" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Enable policy for source validation by reversed path, as specified in
<span class="target" id="index-6"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3704.html"><strong>RFC 3704</strong></a>. Current recommended practice in <span class="target" id="index-7"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3704.html"><strong>RFC 3704</strong></a> is to enable strict
mode to prevent IP spoofing from DDos attacks. If using asymmetric routing
or other complicated routing, then loose mode is recommended.</p>
<ul class="simple">
<li><p>strict: Each incoming packet is tested against the FIB and if the interface
is not the best reverse path the packet check will fail. By default failed
packets are discarded.</p></li>
<li><p>loose: Each incoming packet’s source address is also tested against the FIB
and if the source address is not reachable via any interface the packet
check will fail.</p></li>
<li><p>disable: No source validation</p></li>
</ul>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-ipv6-address-autoconf">
set interfaces vxlan &lt;interface&gt; ipv6 address autoconf</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-ipv6-address-autoconf" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p><abbr title="Stateless Address Autoconfiguration">SLAAC</abbr> <span class="target" id="index-8"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4862.html"><strong>RFC 4862</strong></a>. IPv6 hosts
can configure themselves automatically when connected to an IPv6 network using
the Neighbor Discovery Protocol via <abbr title="Internet Control Message Protocol version 6">ICMPv6</abbr> router discovery messages. When first connected to a
network, a host sends a link-local router solicitation multicast request for
its configuration parameters; routers respond to such a request with a router
advertisement packet that contains Internet Layer configuration parameters.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method automatically disables IPv6 traffic forwarding on the
interface in question.</p>
</div>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 ipv6 address autoconf
</pre></div>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-ipv6-address-eui64-prefix">
set interfaces vxlan &lt;interface&gt; ipv6 address eui64 &lt;prefix&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-ipv6-address-eui64-prefix" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p><abbr title="64-Bit Extended Unique Identifier">EUI-64</abbr> as specified in
<span class="target" id="index-9"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4291.html"><strong>RFC 4291</strong></a> allows a host to assign iteslf a unique 64-Bit IPv6 address.</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 ipv6 address eui64 2001:db8:beef::/64
</pre></div>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-ipv6-address-no-default-link-local">
set interfaces vxlan &lt;interface&gt; ipv6 address no-default-link-local</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-ipv6-address-no-default-link-local" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Do not assign a link-local IPv6 address to this interface.</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 ipv6 address no-default-link-local
</pre></div>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-ipv6-disable-forwarding">
set interfaces vxlan &lt;interface&gt; ipv6 disable-forwarding</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-ipv6-disable-forwarding" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Configure interface-specific Host/Router behaviour. If set, the interface will
switch to host mode and IPv6 forwarding will be disabled on this interface.</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 ipv6 disable-forwarding
</pre></div>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-ipv6-adjust-mss-mss-clamp-mss-to-pmtu">
set interfaces vxlan &lt;interface&gt; ipv6 adjust-mss &lt;mss | clamp-mss-to-pmtu&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-ipv6-adjust-mss-mss-clamp-mss-to-pmtu" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>As Internet wide PMTU discovery rarely works, we sometimes need to clamp our
TCP MSS value to a specific value. This is a field in the TCP options part of
a SYN packet. By setting the MSS value, you are telling the remote side
unequivocally ‘do not try to send me packets bigger than this value’.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command was introduced in VyOS 1.4 - it was previously called:
<code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">firewall</span> <span class="pre">options</span> <span class="pre">interface</span> <span class="pre">&lt;name&gt;</span> <span class="pre">adjust-mss6</span> <span class="pre">&lt;value&gt;</span></code></p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>MSS value = MTU - 40 (IPv6 header) - 20 (TCP header), resulting in
1432 bytes on a 1492 byte MTU.</p>
</div>
<p>Instead of a numerical MSS value <cite>clamp-mss-to-pmtu</cite> can be used to
automatically set the proper value.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-ipv6-accept-dad-1-3">
set interfaces vxlan &lt;interface&gt; ipv6 accept-dad &lt;1-3&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-ipv6-accept-dad-1-3" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Whether to accept DAD (Duplicate Address Detection).</p>
<ul class="simple">
<li><p>0: Disable DAD</p></li>
<li><p>1: Enable DAD (default)</p></li>
<li><p>2: Enable DAD, and disable IPv6 operation if MAC-based duplicate link-local address has been found.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 ipv6 accept-dad 2
</pre></div>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-ipv6-dup-addr-detect-transmits-n">
set interfaces vxlan &lt;interface&gt; ipv6 dup-addr-detect-transmits &lt;n&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-ipv6-dup-addr-detect-transmits-n" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>The amount of Duplicate Address Detection probes to send.</p>
<p>Default: 1</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 ipv6 dup-addr-detect-transmits 5
</pre></div>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-vrf-vrf">
set interfaces vxlan &lt;interface&gt; vrf &lt;vrf&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-vrf-vrf" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Place interface in given VRF instance.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>There is an entire chapter about how to configure a <a class="reference internal" href="../vrf/index.html#vrf"><span class="std std-ref">VRF</span></a>,
please check this for additional information.</p>
</div>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan0 vrf red
</pre></div>
</div>
</div>
</div>
</section>
<section id="vxlan-specific-options">
<h3>VXLAN specific options<a class="headerlink" href="#vxlan-specific-options" title="Link to this heading"></a></h3>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-vni-number">
set interfaces vxlan &lt;interface&gt; vni &lt;number&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-vni-number" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Each VXLAN segment is identified through a 24-bit segment ID, termed the
<abbr title="VXLAN Network Identifier (or VXLAN Segment ID)">VNI</abbr>, This allows
up to 16M VXLAN segments to coexist within the same administrative domain.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-port-port">
set interfaces vxlan &lt;interface&gt; port &lt;port&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-port-port" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Configure port number of remote VXLAN endpoint.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As VyOS is Linux based the default port used is not using 4789
as the default IANA-assigned destination UDP port number. Instead VyOS
uses the Linux default port of 8472.</p>
</div>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-source-address-interface">
set interfaces vxlan &lt;interface&gt; source-address &lt;interface&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-source-address-interface" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Source IP address used for VXLAN underlay. This is mandatory when using VXLAN
via L2VPN/EVPN.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-gpe">
set interfaces vxlan &lt;interface&gt; gpe</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-gpe" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Enables the Generic Protocol extension (VXLAN-GPE). Currently, this is only
supported together with the external keyword.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-parameters-external">
set interfaces vxlan &lt;interface&gt; parameters external</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-parameters-external" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Specifies whether an external control plane (e.g. BGP L2VPN/EVPN) or the
internal FDB should be used.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-parameters-neighbor-suppress">
set interfaces vxlan &lt;interface&gt; parameters neighbor-suppress</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-parameters-neighbor-suppress" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>In order to minimize the flooding of ARP and ND messages in the VXLAN network,
EVPN includes provisions <span class="target" id="index-10"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7432.html#section-10"><strong>RFC 7432 Section 10</strong></a> that allow participating VTEPs
to suppress such messages in case they know the MAC-IP binding and can reply
on behalf of the remote host.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-parameters-nolearning">
set interfaces vxlan &lt;interface&gt; parameters nolearning</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-parameters-nolearning" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Specifies if unknown source link layer addresses and IP addresses are entered
into the VXLAN device forwarding database.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-parameters-vni-filter">
set interfaces vxlan &lt;interface&gt; parameters vni-filter</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-parameters-vni-filter" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Specifies whether the VXLAN device is capable of vni filtering.</p>
<p>Only works with a VXLAN device with external flag set.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The device can only receive packets with VNIs configured in
the VNI filtering table.</p>
</div>
</div>
</div>
<section id="unicast">
<h4>Unicast<a class="headerlink" href="#unicast" title="Link to this heading"></a></h4>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-remote-address">
set interfaces vxlan &lt;interface&gt; remote &lt;address&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-remote-address" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>IPv4/IPv6 remote address of the VXLAN tunnel. Alternative to multicast, the
remote IPv4/IPv6 address can set directly.</p>
</div>
</div>
</section>
<section id="multicast">
<h4>Multicast<a class="headerlink" href="#multicast" title="Link to this heading"></a></h4>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-source-interface-interface">
set interfaces vxlan &lt;interface&gt; source-interface &lt;interface&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-source-interface-interface" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Interface used for VXLAN underlay. This is mandatory when using VXLAN via
a multicast network. VXLAN traffic will always enter and exit this interface.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-group-address">
set interfaces vxlan &lt;interface&gt; group &lt;address&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-group-address" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Multicast group address for VXLAN interface. VXLAN tunnels can be built
either via Multicast or via Unicast.</p>
<p>Both IPv4 and IPv6 multicast is possible.</p>
</div>
</div>
</section>
</section>
</section>
<section id="multicast-vxlan">
<h2>Multicast VXLAN<a class="headerlink" href="#multicast-vxlan" title="Link to this heading"></a></h2>
<p>Topology: PC4 - Leaf2 - Spine1 - Leaf3 - PC5</p>
<p>PC4 has IP 10.0.0.4/24 and PC5 has IP 10.0.0.5/24, so they believe they are in
the same broadcast domain.</p>
<p>Let’s assume PC4 on Leaf2 wants to ping PC5 on Leaf3. Instead of setting Leaf3
as our remote end manually, Leaf2 encapsulates the packet into a UDP-packet and
sends it to its designated multicast-address via Spine1. When Spine1 receives
this packet it forwards it to all other leaves who has joined the same
multicast-group, in this case Leaf3. When Leaf3 receives the packet it forwards
it, while at the same time learning that PC4 is reachable behind Leaf2, because
the encapsulated packet had Leaf2’s IP address set as source IP.</p>
<p>PC5 receives the ping echo, responds with an echo reply that Leaf3 receives and
this time forwards to Leaf2’s unicast address directly because it learned the
location of PC4 above. When Leaf2 receives the echo reply from PC5 it sees that
it came from Leaf3 and so remembers that PC5 is reachable via Leaf3.</p>
<p>Thanks to this discovery, any subsequent traffic between PC4 and PC5 will not
be using the multicast-address between the leaves as they both know behind which
Leaf the PCs are connected. This saves traffic as less multicast packets sent
reduces the load on the network, which improves scalability when more leaves are
added.</p>
<p>For optimal scalability, Multicast shouldn’t be used at all, but instead use BGP
to signal all connected devices between leaves. Unfortunately, VyOS does not yet
support this.</p>
</section>
<section id="single-vxlan-device-svd">
<h2>Single VXLAN device (SVD)<a class="headerlink" href="#single-vxlan-device-svd" title="Link to this heading"></a></h2>
<p>FRR supports a new way of configuring VLAN-to-VNI mappings for EVPN-VXLAN, when
working with the Linux kernel. In this new way, the mapping of a VLAN to a
<abbr title="VXLAN Network Identifier (or VXLAN Segment ID)">VNI</abbr> is configured
against a container VXLAN interface which is referred to as a
<abbr title="Single VXLAN device">SVD</abbr>.</p>
<p>Multiple VLAN to VNI mappings can be configured against the same SVD. This
allows for a significant scaling of the number of VNIs since a separate VXLAN
interface is no longer required for each VNI.</p>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-interfaces-vxlan-interface-vlan-to-vni-vlan-vni-vni">
set interfaces vxlan &lt;interface&gt; vlan-to-vni &lt;vlan&gt; vni &lt;vni&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-interfaces-vxlan-interface-vlan-to-vni-vlan-vni-vni" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Maps the VNI to the specified VLAN id. The VLAN can then be consumed by
a bridge.</p>
<p>Sample configuration of SVD with VLAN to VNI mappings is shown below.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces bridge br0 member interface vxlan0
set interfaces vxlan vxlan0 parameters external
set interfaces vxlan vxlan0 source-interface &#39;dum0&#39;
set interfaces vxlan vxlan0 vlan-to-vni 10 vni &#39;10010&#39;
set interfaces vxlan vxlan0 vlan-to-vni 11 vni &#39;10011&#39;
set interfaces vxlan vxlan0 vlan-to-vni 30 vni &#39;10030&#39;
set interfaces vxlan vxlan0 vlan-to-vni 31 vni &#39;10031&#39;
</pre></div>
</div>
</div>
</div>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Link to this heading"></a></h3>
<p>The setup is this: Leaf2 - Spine1 - Leaf3</p>
<p>Spine1 is a Cisco IOS router running version 15.4, Leaf2 and Leaf3 is each a
VyOS router running 1.2.</p>
<p>This topology was built using GNS3.</p>
<p>Topology:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Spine1:
fa0/2 towards Leaf2, IP-address: 10.1.2.1/24
fa0/3 towards Leaf3, IP-address: 10.1.3.1/24

Leaf2:
Eth0 towards Spine1, IP-address: 10.1.2.2/24
Eth1 towards a vlan-aware switch

Leaf3:
Eth0 towards Spine1, IP-address 10.1.3.3/24
Eth1 towards a vlan-aware switch
</pre></div>
</div>
<p><strong>Spine1 Configuration:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>conf t
ip multicast-routing
!
interface fastethernet0/2
 ip address 10.1.2.1 255.255.255.0
 ip pim sparse-dense-mode
!
interface fastethernet0/3
 ip address 10.1.3.1 255.255.255.0
 ip pim sparse-dense-mode
!
router ospf 1
 network 10.0.0.0 0.255.255.255 area 0
</pre></div>
</div>
<p>Multicast-routing is required for the leaves to forward traffic between each
other in a more scalable way. This also requires PIM to be enabled towards the
leaves so that the Spine can learn what multicast groups each Leaf expects
traffic from.</p>
<p><strong>Leaf2 configuration:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces ethernet eth0 address &#39;10.1.2.2/24&#39;
set protocols ospf area 0 network &#39;10.0.0.0/8&#39;

! Our first vxlan interface
set interfaces bridge br241 address &#39;172.16.241.1/24&#39;
set interfaces bridge br241 member interface &#39;eth1.241&#39;
set interfaces bridge br241 member interface &#39;vxlan241&#39;

set interfaces vxlan vxlan241 group &#39;239.0.0.241&#39;
set interfaces vxlan vxlan241 source-interface &#39;eth0&#39;
set interfaces vxlan vxlan241 vni &#39;241&#39;

! Our seconds vxlan interface
set interfaces bridge br242 address &#39;172.16.242.1/24&#39;
set interfaces bridge br242 member interface &#39;eth1.242&#39;
set interfaces bridge br242 member interface &#39;vxlan242&#39;

set interfaces vxlan vxlan242 group &#39;239.0.0.242&#39;
set interfaces vxlan vxlan242 source-interface &#39;eth0&#39;
set interfaces vxlan vxlan242 vni &#39;242&#39;
</pre></div>
</div>
<p><strong>Leaf3 configuration:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces ethernet eth0 address &#39;10.1.3.3/24&#39;
set protocols ospf area 0 network &#39;10.0.0.0/8&#39;

! Our first vxlan interface
set interfaces bridge br241 address &#39;172.16.241.1/24&#39;
set interfaces bridge br241 member interface &#39;eth1.241&#39;
set interfaces bridge br241 member interface &#39;vxlan241&#39;

set interfaces vxlan vxlan241 group &#39;239.0.0.241&#39;
set interfaces vxlan vxlan241 source-interface &#39;eth0&#39;
set interfaces vxlan vxlan241 vni &#39;241&#39;

! Our seconds vxlan interface
set interfaces bridge br242 address &#39;172.16.242.1/24&#39;
set interfaces bridge br242 member interface &#39;eth1.242&#39;
set interfaces bridge br242 member interface &#39;vxlan242&#39;

set interfaces vxlan vxlan242 group &#39;239.0.0.242&#39;
set interfaces vxlan vxlan242 source-interface &#39;eth0&#39;
set interfaces vxlan vxlan242 vni &#39;242&#39;
</pre></div>
</div>
<p>As you can see, Leaf2 and Leaf3 configuration is almost identical. There are
lots of commands above, I’ll try to into more detail below, command
descriptions are placed under the command boxes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces bridge br241 address &#39;172.16.241.1/24&#39;
</pre></div>
</div>
<p>This commands creates a bridge that is used to bind traffic on eth1 vlan 241
with the vxlan241-interface. The IP address is not required. It may however be
used as a default gateway for each Leaf which allows devices on the vlan to
reach other subnets. This requires that the subnets are redistributed by OSPF
so that the Spine will learn how to reach it. To do this you need to change the
OSPF network from ‘10.0.0.0/8’ to ‘0.0.0.0/0’ to allow 172.16/12-networks to be
advertised.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces bridge br241 member interface &#39;eth1.241&#39;
set interfaces bridge br241 member interface &#39;vxlan241&#39;
</pre></div>
</div>
<p>Binds eth1.241 and vxlan241 to each other by making them both member
interfaces of the same bridge.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan241 group &#39;239.0.0.241&#39;
</pre></div>
</div>
<p>The multicast-group used by all leaves for this vlan extension. Has to be the
same on all leaves that has this interface.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan241 source-interface &#39;eth0&#39;
</pre></div>
</div>
<p>Sets the interface to listen for multicast packets on. Could be a loopback, not
yet tested.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan241 vni &#39;241&#39;
</pre></div>
</div>
<p>Sets the unique id for this vxlan-interface. Not sure how it correlates with
multicast-address.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces vxlan vxlan241 port 12345
</pre></div>
</div>
<p>The destination port used for creating a VXLAN interface in Linux defaults to
its pre-standard value of 8472 to preserve backward compatibility. A
configuration directive to support a user-specified destination port to override
that behavior is available using the above command.</p>
</section>
</section>
<section id="unicast-vxlan">
<h2>Unicast VXLAN<a class="headerlink" href="#unicast-vxlan" title="Link to this heading"></a></h2>
<p>Alternative to multicast, the remote IPv4 address of the VXLAN tunnel can be
set directly. Let’s change the Multicast example from above:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># leaf2 and leaf3
delete interfaces vxlan vxlan241 group &#39;239.0.0.241&#39;
delete interfaces vxlan vxlan241 source-interface &#39;eth0&#39;

# leaf2
set interface vxlan vxlan241 remote 10.1.3.3

# leaf3
set interface vxlan vxlan241 remote 10.1.2.2
</pre></div>
</div>
<p>The default port udp is set to 8472.
It can be changed with <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">interface</span> <span class="pre">vxlan</span> <span class="pre">&lt;vxlanN&gt;</span> <span class="pre">port</span> <span class="pre">&lt;port&gt;</span></code></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="vti.html" class="btn btn-neutral float-left" title="VTI - Virtual Tunnel Interface" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="wireless.html" class="btn btn-neutral float-right" title="WLAN/WIFI - Wireless LAN" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../copyright.html">Copyright</a> 2023, VyOS maintainers and contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>