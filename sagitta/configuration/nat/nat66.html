

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NAT66(NPTv6) &mdash; VyOS 1.4.x (sagitta) documentation</title>
      <link rel="stylesheet" type="text/css" href="../../static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="../../static/vyos-logo-icon.png"/>
      <script src="../../static/jquery.js?v=5d32c60e"></script>
      <script src="../../static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../static/documentation_options.js?v=8f5ed1cd"></script>
      <script src="../../static/doctools.js?v=9bcbadda"></script>
      <script src="../../static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../static/design-tabs.js?v=f930bc37"></script>
    <script src="../../static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="Policy" href="../policy/index.html" />
    <link rel="prev" title="NAT64" href="nat64.html" />
    <style>#vyos-header-iframe{position:fixed;top:0;left:0;right:0;z-index:999999999;width:100%;border:none}</style>
    <style>#vyos-footer-iframe{width:100%;border:none}</style>
    <link href="../../static/css/custom.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/lists.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/hints.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/headers.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/breadcrumbs.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/linkButtons.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/text.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/leftSidebar.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/scrolls.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/tables.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/installation/running-on-bare-metal.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/code-snippets.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/separate-commands.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/configuration/index.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/datatables.css" rel="stylesheet" type="text/css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script type="text/javascript" charset="utf8" src="../../static/js/datatables.js"></script>
    <script type="text/javascript" charset="utf8" src="../../static/js/tables.js"></script>
    <script type="text/javascript" charset="utf8" src="../../static/js/codecopier.js"></script>
    <script type="text/javascript" charset="utf8" src="../../static/js/sidebar.js"></script>
    <script type="text/javascript" charset="utf8" src="../../static/js/footer.js"></script>
    </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            VyOS
              <img src="../../static/vyos-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../introducing/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introducing/history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog/index.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">First Steps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation and Image Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quick-start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli.html#configuration-overview">Configuration Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Adminguide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Configuration Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../container/index.html">Container</a></li>
<li class="toctree-l2"><a class="reference internal" href="../firewall/index.html">Firewall</a></li>
<li class="toctree-l2"><a class="reference internal" href="../highavailability/index.html">High availability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interfaces/index.html">Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../loadbalancing/index.html">Load-balancing</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">NAT</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="nat44.html">NAT44</a></li>
<li class="toctree-l3"><a class="reference internal" href="nat64.html">NAT64</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">NAT66(NPTv6)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration-examples">Configuration Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../policy/index.html">Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pki/index.html">PKI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/index.html">Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../service/index.html">Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../system/index.html">System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../trafficpolicy/index.html">Traffic Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vpn/index.html">VPN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vrf/index.html">VRF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vrf/index.html#l3vpn-vrfs">L3VPN VRFs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../operation/index.html">Operation Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../automation/index.html">VyOS Automation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configexamples/index.html">Configuration Blueprints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configexamples/index.html#configuration-blueprints-autotest">Configuration Blueprints (autotest)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/build-vyos.html">Build VyOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/issues-features.html">Issues/Feature requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/upstream-packages.html">Upstream packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/testing.html">Testing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">Write Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../coverage.html">Coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../copyright.html">Copyright Notice</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">VyOS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Configuration Guide</a></li>
          <li class="breadcrumb-item"><a href="index.html">NAT</a></li>
      <li class="breadcrumb-item active">NAT66(NPTv6)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../sources/configuration/nat/nat66.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nat66-nptv6">
<span id="nat66"></span><h1>NAT66(NPTv6)<a class="headerlink" href="#nat66-nptv6" title="Link to this heading"></a></h1>
<p><abbr title="IPv6-to-IPv6 Network Prefix Translation">NPTv6</abbr> is an address
translation technology based on IPv6 networks, used to convert an IPv6
address prefix in an IPv6 message into another IPv6 address prefix.
We call this address translation method NAT66. Devices that support the NAT66
function are called NAT66 devices, which can provide NAT66 source
and destination address translation functions.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<section id="different-nat-types">
<h3>Different NAT Types<a class="headerlink" href="#different-nat-types" title="Link to this heading"></a></h3>
<section id="snat66">
<span id="source-nat66"></span><h4>SNAT66<a class="headerlink" href="#snat66" title="Link to this heading"></a></h4>
<p><abbr title="Source IPv6-to-IPv6 Network Prefix Translation">SNPTv6</abbr> The conversion
function is mainly used in the following scenarios:</p>
<ul class="simple">
<li><p>A single internal network and external network. Use the NAT66 device to
connect a single internal network and public network, and the hosts in
the internal network use IPv6 address prefixes that only support
routing within the local range. When a host in the internal network
accesses the external network, the source IPv6 address prefix in
the message will be converted into a global unicast IPv6 address
prefix by the NAT66 device.</p></li>
<li><p>Redundancy and load sharing. There are multiple NAT66 devices at the edge
of an IPv6 network to another IPv6 network. The path through the NAT66
device to another IPv6 network forms an equivalent route, and traffic
can be load-shared on these NAT66 devices. In this case, you
can configure the same source address translation rules on these
NAT66 devices, so that any NAT66 device can handle IPv6 traffic between
different sites.</p></li>
<li><p>Multi-homed. In a multi-homed network environment, the NAT66 device
connects to an internal network and simultaneously connects to
different external networks. Address translation can be configured
on each external network side interface of the NAT66 device to
convert the same internal network address into different external
network addresses, and realize the mapping of the same internal
address to multiple external addresses.</p></li>
</ul>
</section>
<section id="dnat66">
<span id="destination-nat66"></span><h4>DNAT66<a class="headerlink" href="#dnat66" title="Link to this heading"></a></h4>
<p>The <abbr title="Destination IPv6-to-IPv6 Network Prefix Translation">DNPTv6</abbr>
destination address translation function is used in scenarios where the
server in the internal network provides services to the external network,
such as providing Web services or FTP services to the external network.
By configuring the mapping relationship between the internal server
address and the external network address on the external network
side interface of the NAT66 device, external network users can
access the internal network server through the designated
external network address.</p>
</section>
</section>
<section id="prefix-conversion">
<h3>Prefix Conversion<a class="headerlink" href="#prefix-conversion" title="Link to this heading"></a></h3>
<section id="source-prefix">
<h4>Source Prefix<a class="headerlink" href="#source-prefix" title="Link to this heading"></a></h4>
<p>Every SNAT66 rule has a translation command defined. The prefix defined
for the translation is the prefix used when the address information in
a packet is replaced.、</p>
<p>The <a class="reference internal" href="#source-nat66"><span class="std std-ref">SNAT66</span></a> rule replaces the source address of the packet
and calculates the converted address using the prefix specified in the rule.</p>
<p>Example:</p>
<ul class="simple">
<li><p>Convert the address prefix of a single <cite>fc01::/64</cite> network to <cite>fc00::/64</cite></p></li>
<li><p>Output from <cite>eth0</cite> network interface</p></li>
</ul>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set nat66 source rule 1 outbound-interface &#39;eth0&#39;
set nat66 source rule 1 source prefix &#39;fc01::/64&#39;
set nat66 source rule 1 translation address &#39;fc00::/64&#39;
</pre></div>
</div>
</section>
<section id="destination-prefix">
<h4>Destination Prefix<a class="headerlink" href="#destination-prefix" title="Link to this heading"></a></h4>
<p>For the <a class="reference internal" href="#destination-nat66"><span class="std std-ref">DNAT66</span></a> rule, the destination address of
the packet isreplaced by the address calculated from the specified
address or prefix in the <cite>translation address</cite> command</p>
<p>Example:</p>
<ul class="simple">
<li><p>Convert the address prefix of a single <cite>fc00::/64</cite> network
to <cite>fc01::/64</cite></p></li>
<li><p>Input from <cite>eth0</cite> network interface</p></li>
</ul>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set nat66 destination rule 1 inbound-interface &#39;eth0&#39;
set nat66 destination rule 1 destination address &#39;fc00::/64&#39;
set nat66 destination rule 1 translation address &#39;fc01::/64&#39;
</pre></div>
</div>
</section>
</section>
</section>
<section id="configuration-examples">
<h2>Configuration Examples<a class="headerlink" href="#configuration-examples" title="Link to this heading"></a></h2>
<p>Use the following topology to build a nat66 based isolated
network between internal and external networks (dynamic prefix is
not supported):</p>
<figure class="align-default">
<img alt="VyOS NAT66 Simple Configure" src="../../images/vyos_1_4_nat66_simple.png" />
</figure>
<p>R1:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces ethernet eth0 ipv6 address autoconf
set interfaces ethernet eth1 address &#39;fc01::1/64&#39;
set nat66 destination rule 1 destination address &#39;fc00:470:f1cd:101::/64&#39;
set nat66 destination rule 1 inbound-interface &#39;eth0&#39;
set nat66 destination rule 1 translation address &#39;fc01::/64&#39;
set nat66 source rule 1 outbound-interface &#39;eth0&#39;
set nat66 source rule 1 source prefix &#39;fc01::/64&#39;
set nat66 source rule 1 translation address &#39;fc00:470:f1cd:101::/64&#39;
</pre></div>
</div>
<p>R2:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces bridge br1 address &#39;fc01::2/64&#39;
set interfaces bridge br1 member interface eth0
set interfaces bridge br1 member interface eth1
set protocols static route6 ::/0 next-hop fc01::1
set service router-advert interface br1 prefix ::/0
</pre></div>
</div>
<p>Use the following topology to translate internal user local addresses (<code class="docutils literal notranslate"><span class="pre">fc::/7</span></code>)
to DHCPv6-PD provided prefixes from an ISP connected to a VyOS HA pair.</p>
<figure class="align-default">
<img alt="VyOS NAT66 DHCPv6 using a dummy interface" src="../../images/vyos_1_5_nat66_dhcpv6_wdummy.png" />
</figure>
<p>Configure both routers (a and b) for DHCPv6-PD via dummy interface:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set interfaces dummy dum1 description &#39;DHCPv6-PD NPT dummy&#39;
set interfaces bonding bond0 vif 20 dhcpv6-options pd 0 interface dum1 address &#39;0&#39;
set interfaces bonding bond0 vif 20 dhcpv6-options pd 1 interface dum1 address &#39;0&#39;
set interfaces bonding bond0 vif 20 dhcpv6-options pd 2 interface dum1 address &#39;0&#39;
set interfaces bonding bond0 vif 20 dhcpv6-options pd 3 interface dum1 address &#39;0&#39;
set interfaces bonding bond0 vif 20 dhcpv6-options rapid-commit
commit
</pre></div>
</div>
<p>Get the DHCPv6-PD prefixes from both routers:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>trae@cr01a-vyos# run show interfaces dummy dum1 br
Codes: S - State, L - Link, u - Up, D - Down, A - Admin Down
Interface        IP Address                        S/L  Description
---------        ----------                        ---  -----------
dum1             2001:db8:123:b008::/64           u/u  DHCPv6-PD NPT dummy
                 2001:db8:123:b00a::/64
                 2001:db8:123:b00b::/64
                 2001:db8:123:b009::/64

trae@cr01b-vyos# run show int dummy dum1 brief
Codes: S - State, L - Link, u - Up, D - Down, A - Admin Down
Interface        IP Address                        S/L  Description
---------        ----------                        ---  -----------
dum1             2001:db8:123:b00d::/64           u/u  DHCPv6-PD NPT dummy
                 2001:db8:123:b00c::/64
                 2001:db8:123:b00e::/64
                 2001:db8:123:b00f::/64
</pre></div>
</div>
<p>Configure the A-side router for NPTv6 using the prefixes above:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set nat66 source rule 10 description &#39;NPT to VLAN 10&#39;
set nat66 source rule 10 outbound-interface name &#39;bond0.20&#39;
set nat66 source rule 10 source prefix &#39;fd52:d62e:8011:a::/64&#39;
set nat66 source rule 10 translation address &#39;2001:db8:123:b008::/64&#39;
set nat66 source rule 20 description &#39;NPT to VLAN 70&#39;
set nat66 source rule 20 outbound-interface name &#39;bond0.20&#39;
set nat66 source rule 20 source prefix &#39;fd52:d62e:8011:46::/64&#39;
set nat66 source rule 20 translation address &#39;2001:db8:123:b009::/64&#39;
set nat66 source rule 30 description &#39;NPT to VLAN 200&#39;
set nat66 source rule 30 outbound-interface name &#39;bond0.20&#39;
set nat66 source rule 30 source prefix &#39;fd52:d62e:8011:c8::/64&#39;
set nat66 source rule 30 translation address &#39;2001:db8:123:b00a::/64&#39;
set nat66 source rule 40 description &#39;NPT to VLAN 240&#39;
set nat66 source rule 40 outbound-interface name &#39;bond0.20&#39;
set nat66 source rule 40 source prefix &#39;fd52:d62e:8011:f0::/64&#39;
set nat66 source rule 40 translation address &#39;2001:db8:123:b00b::/64&#39;
commit
</pre></div>
</div>
<p>Configure the B-side router for NPTv6 using the prefixes above:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set nat66 source rule 10 description &#39;NPT to VLAN 10&#39;
set nat66 source rule 10 outbound-interface name &#39;bond0.20&#39;
set nat66 source rule 10 source prefix &#39;fd52:d62e:8011:a::/64&#39;
set nat66 source rule 10 translation address &#39;2001:db8:123:b00c::/64&#39;
set nat66 source rule 20 description &#39;NPT to VLAN 70&#39;
set nat66 source rule 20 outbound-interface name &#39;bond0.20&#39;
set nat66 source rule 20 source prefix &#39;fd52:d62e:8011:46::/64&#39;
set nat66 source rule 20 translation address &#39;2001:db8:123:b00d::/64&#39;
set nat66 source rule 30 description &#39;NPT to VLAN 200&#39;
set nat66 source rule 30 outbound-interface name &#39;bond0.20&#39;
set nat66 source rule 30 source prefix &#39;fd52:d62e:8011:c8::/64&#39;
set nat66 source rule 30 translation address &#39;2001:db8:123:b00e::/64&#39;
set nat66 source rule 40 description &#39;NPT to VLAN 240&#39;
set nat66 source rule 40 outbound-interface name &#39;bond0.20&#39;
set nat66 source rule 40 source prefix &#39;fd52:d62e:8011:f0::/64&#39;
set nat66 source rule 40 translation address &#39;2001:db8:123:b00f::/64&#39;
commit
</pre></div>
</div>
<p>Verify that connections are hitting the rule on both sides:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>trae@cr01a-vyos# run show nat66 source statistics
Rule    Packets    Bytes    Interface
------  ---------  -------  -----------
10      1          104      bond0.20
20      1          104      bond0.20
30      8093       669445   bond0.20
40      2446       216912   bond0.20
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="nat64.html" class="btn btn-neutral float-left" title="NAT64" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../policy/index.html" class="btn btn-neutral float-right" title="Policy" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../copyright.html">Copyright</a> 2023, VyOS maintainers and contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>