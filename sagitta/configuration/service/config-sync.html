

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Config Sync &mdash; VyOS 1.4.x (sagitta) documentation</title>
      <link rel="stylesheet" type="text/css" href="../../static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="../../static/vyos-logo-icon.png"/>
      <script src="../../static/jquery.js?v=5d32c60e"></script>
      <script src="../../static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../static/documentation_options.js?v=8f5ed1cd"></script>
      <script src="../../static/doctools.js?v=9bcbadda"></script>
      <script src="../../static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../static/design-tabs.js?v=f930bc37"></script>
    <script src="../../static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="Conntrack Sync" href="conntrack-sync.html" />
    <link rel="prev" title="UDP Broadcast Relay" href="broadcast-relay.html" />
    <style>#vyos-header-iframe{position:fixed;top:0;left:0;right:0;z-index:999999999;width:100%;border:none}</style>
    <style>#vyos-footer-iframe{width:100%;border:none}</style>
    <link href="../../static/css/custom.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/lists.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/hints.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/headers.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/breadcrumbs.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/linkButtons.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/text.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/leftSidebar.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/scrolls.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/tables.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/installation/running-on-bare-metal.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/code-snippets.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/separate-commands.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/configuration/index.css" rel="stylesheet" type="text/css">
    <link href="../../static/css/datatables.css" rel="stylesheet" type="text/css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script type="text/javascript" charset="utf8" src="../../static/js/datatables.js"></script>
    <script type="text/javascript" charset="utf8" src="../../static/js/tables.js"></script>
    <script type="text/javascript" charset="utf8" src="../../static/js/codecopier.js"></script>
    <script type="text/javascript" charset="utf8" src="../../static/js/sidebar.js"></script>
    <script type="text/javascript" charset="utf8" src="../../static/js/footer.js"></script>
    </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            VyOS
              <img src="../../static/vyos-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../introducing/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introducing/history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog/index.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">First Steps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation and Image Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quick-start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli.html#configuration-overview">Configuration Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Adminguide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Configuration Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../container/index.html">Container</a></li>
<li class="toctree-l2"><a class="reference internal" href="../firewall/index.html">Firewall</a></li>
<li class="toctree-l2"><a class="reference internal" href="../highavailability/index.html">High availability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interfaces/index.html">Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../loadbalancing/index.html">Load-balancing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nat/index.html">NAT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../policy/index.html">Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pki/index.html">PKI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/index.html">Protocols</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Service</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="broadcast-relay.html">UDP Broadcast Relay</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Config Sync</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#known-issues">Known issues</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="conntrack-sync.html">Conntrack Sync</a></li>
<li class="toctree-l3"><a class="reference internal" href="console-server.html">Console Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="dhcp-relay.html">DHCP Relay</a></li>
<li class="toctree-l3"><a class="reference internal" href="dhcp-server.html">DHCP Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="dns.html">DNS Forwarding</a></li>
<li class="toctree-l3"><a class="reference internal" href="dns.html#dynamic-dns">Dynamic DNS</a></li>
<li class="toctree-l3"><a class="reference internal" href="eventhandler.html">Event Handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="https.html">HTTP API</a></li>
<li class="toctree-l3"><a class="reference internal" href="ids.html">DDoS Protection</a></li>
<li class="toctree-l3"><a class="reference internal" href="ipoe-server.html">IPoE Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="lldp.html">LLDP</a></li>
<li class="toctree-l3"><a class="reference internal" href="mdns.html">mDNS Repeater</a></li>
<li class="toctree-l3"><a class="reference internal" href="monitoring.html">Monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="ntp.html">NTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="pppoe-server.html">PPPoE Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="router-advert.html">Router Advertisements</a></li>
<li class="toctree-l3"><a class="reference internal" href="salt-minion.html">Salt-Minion</a></li>
<li class="toctree-l3"><a class="reference internal" href="snmp.html">SNMP</a></li>
<li class="toctree-l3"><a class="reference internal" href="ssh.html">SSH</a></li>
<li class="toctree-l3"><a class="reference internal" href="tftp-server.html">TFTP Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="webproxy.html">Webproxy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../system/index.html">System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../trafficpolicy/index.html">Traffic Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vpn/index.html">VPN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vrf/index.html">VRF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vrf/index.html#l3vpn-vrfs">L3VPN VRFs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../operation/index.html">Operation Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../automation/index.html">VyOS Automation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configexamples/index.html">Configuration Blueprints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configexamples/index.html#configuration-blueprints-autotest">Configuration Blueprints (autotest)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/build-vyos.html">Build VyOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/issues-features.html">Issues/Feature requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/upstream-packages.html">Upstream packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/testing.html">Testing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">Write Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../coverage.html">Coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../copyright.html">Copyright Notice</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">VyOS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Configuration Guide</a></li>
          <li class="breadcrumb-item"><a href="index.html">Service</a></li>
      <li class="breadcrumb-item active">Config Sync</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../sources/configuration/service/config-sync.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="config-sync">
<span id="id1"></span><h1>Config Sync<a class="headerlink" href="#config-sync" title="Link to this heading"></a></h1>
<p>Configuration synchronization (config sync) is a feature of VyOS that
permits synchronization of the configuration of one VyOS router to
another in a network.</p>
<p>The main benefit to configuration synchronization is that it eliminates having
to manually replicate configuration changes made on the primary router to the
secondary (replica) router.</p>
<p>The writing of the configuration to the secondary router is performed through
the VyOS HTTP API. The user can specify which portion(s) of the configuration will
be synchronized and the mode to use - whether to replace or add.</p>
<p>To prevent issues with divergent configurations between the pair of routers,
synchronization is strictly unidirectional from primary to replica. Both
routers should be online and run the same version of VyOS.</p>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h2>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-service-config-sync-secondary-address-key-timeout-port">
set service config-sync secondary &lt;address|key|timeout|port&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-service-config-sync-secondary-address-key-timeout-port" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Specify the address, API key, timeout and port of the secondary router.
You need to enable and configure the HTTP API service on the secondary
router for config sync to operate.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-service-config-sync-section-section">
set service config-sync section &lt;section&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-service-config-sync-section-section" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Specify the section of the configuration to synchronize. If more than one
section is to be synchronized, repeat the command to add additional
sections as required.</p>
</div>
</div>
<div class="cmd cmd-cfg">
<div class="cfgcmd-heading">
<span class="cfgcmd" id="cfgcmd-set-service-config-sync-mode-load-set">
set service config-sync mode &lt;load|set&gt;</span>
<a class="cmdlink" href="#cfgcmd-set-service-config-sync-mode-load-set" title="Permalink to this Command"></a></div><div class="cfgcmd-body">
<p>Two options are available for <cite>mode</cite>: either <cite>load</cite> and replace or <cite>set</cite>
the configuration section.</p>
</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Supported options for &lt;section&gt; include:
    firewall
    interfaces &lt;interface&gt;
    nat
    nat66
    pki
    policy
    protocols &lt;protocol&gt;
    qos &lt;interface|policy&gt;
    service &lt;service&gt;
    system &lt;conntrack|
    flow-accounting|option|sflow|static-host-mapping|sysctl|time-zone&gt;
    vpn
    vrf
</pre></div>
</div>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Synchronize the time-zone and OSPF configuration from Router A to Router B</p></li>
<li><p>The address of Router B is 10.0.20.112 and the port used is 8443</p></li>
</ul>
<p>Configure the HTTP API service on Router B</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set service https listen-address &#39;10.0.20.112&#39;
set service https port &#39;8443&#39;
set service https api keys id KID key &#39;foo&#39;
</pre></div>
</div>
<p>Configure the config-sync service on Router A</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set service config-sync mode &#39;load&#39;
set service config-sync secondary address &#39;10.0.20.112&#39;
set service config-sync secondary port &#39;8443&#39;
set service config-sync secondary key &#39;foo&#39;
set service config-sync section protocols &#39;ospf&#39;
set service config-sync section system &#39;time-zone&#39;
</pre></div>
</div>
<p>Make config-sync relevant changes to Router A’s configuration</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>vyos@vyos-A# set system time-zone &#39;America/Los_Angeles&#39;
vyos@vyos-A# commit
INFO:vyos_config_sync:Config synchronization: Mode=load,
Secondary=10.0.20.112
vyos@vyos-A# save

vyos@vyos-A# set protocols ospf area 0 network &#39;10.0.48.0/30&#39;
vyos@vyos-A# commit
INFO:vyos_config_sync:Config synchronization: Mode=load,
Secondary=10.0.20.112
yos@vyos-A# save
</pre></div>
</div>
<p>Verify configuration changes have been replicated to Router B</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>vyos@vyos-B:~$ show configuration commands | match time-zone
set system time-zone &#39;America/Los_Angeles&#39;

vyos@vyos-B:~$ show configuration commands | match ospf
set protocols ospf area 0 network &#39;10.0.48.0/30&#39;
</pre></div>
</div>
</section>
<section id="known-issues">
<h2>Known issues<a class="headerlink" href="#known-issues" title="Link to this heading"></a></h2>
<p>Configuration resynchronization. With the current implementation of <cite>service
config-sync</cite>, the secondary node must be online.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="broadcast-relay.html" class="btn btn-neutral float-left" title="UDP Broadcast Relay" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="conntrack-sync.html" class="btn btn-neutral float-right" title="Conntrack Sync" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../copyright.html">Copyright</a> 2023, VyOS maintainers and contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>